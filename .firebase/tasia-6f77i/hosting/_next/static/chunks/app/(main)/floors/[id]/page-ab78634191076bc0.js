(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6659],{56770:function(e,t,r){Promise.resolve().then(r.bind(r,48959))},95137:function(e,t,r){"use strict";r.d(t,{Z:function(){return n}});/**
 * @license lucide-react v0.395.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let n=(0,r(78030).Z)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},3274:function(e,t,r){"use strict";r.d(t,{Z:function(){return n}});/**
 * @license lucide-react v0.395.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let n=(0,r(78030).Z)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},58184:function(e,t,r){"use strict";r.d(t,{Z:function(){return n}});/**
 * @license lucide-react v0.395.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let n=(0,r(78030).Z)("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]])},16463:function(e,t,r){"use strict";var n=r(71169);r.o(n,"useParams")&&r.d(t,{useParams:function(){return n.useParams}}),r.o(n,"usePathname")&&r.d(t,{usePathname:function(){return n.usePathname}}),r.o(n,"useRouter")&&r.d(t,{useRouter:function(){return n.useRouter}}),r.o(n,"useSearchParams")&&r.d(t,{useSearchParams:function(){return n.useSearchParams}})},58064:function(e,t,r){"use strict";Object.defineProperty(t,"$",{enumerable:!0,get:function(){return i}});let n=r(74590);function i(e){let{createServerReference:t}=r(6671);return t(e,n.callServer)}},48959:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return w}});var n=r(57437),i=r(2265),s=r(16463),o=r(69842),a=r(89506),l=r(57697),c=r(86763),d=r(3274),u=r(89733),f=r(95137);function p(e){let{floor:t,onBack:r}=e;return(0,n.jsx)("div",{className:"flex items-center justify-between",children:(0,n.jsxs)("div",{className:"flex items-center gap-4",children:[(0,n.jsxs)(u.z,{variant:"outline",size:"sm",className:"w-fit",type:"button",onClick:r,children:[(0,n.jsx)(f.Z,{className:"mr-2 h-4 w-4"}),"Επιστροφή"]}),(0,n.jsxs)("div",{children:[(0,n.jsxs)("h1",{className:"text-xl font-bold",children:["Όροφος: ",t.level]}),(0,n.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Περιγραφή: ",t.description||"N/A"]})]})]})})}var m=r(48185);function h(e){let{pdfUrl:t}=e,[r,s]=(0,i.useState)(null),[o,a]=(0,i.useState)(!1),[u,f]=(0,i.useState)(null),{toast:p}=(0,c.pm)();return((0,i.useEffect)(()=>{if(!t){f(null),s(null),a(!1);return}(async()=>{a(!0),f(null);try{let e=(0,l.cF)(),r=(0,l.iH)(e,t),n=await (0,l.Jt)(r);s(n)}catch(e){console.error("Error getting download URL:",e),f("Η φόρτωση της κάτοψης απέτυχε."),p({variant:"destructive",title:"Σφάλμα Φόρτωσης PDF",description:"Code: ".concat(e.code,". Message: ").concat(e.message)})}finally{a(!1)}})()},[t,p]),o)?(0,n.jsxs)("div",{className:"flex h-96 w-full items-center justify-center",children:[(0,n.jsx)(d.Z,{className:"h-8 w-8 animate-spin text-muted-foreground"}),(0,n.jsx)("p",{className:"ml-2",children:"Φόρτωση κάτοψης..."})]}):u?(0,n.jsx)("div",{className:"flex flex-col items-center justify-center h-40 border-2 border-dashed border-destructive/50 rounded-lg p-4",children:(0,n.jsx)("p",{className:"text-destructive font-semibold",children:u})}):t&&r?(0,n.jsx)("div",{style:{height:"75vh",border:"1px solid rgba(0, 0, 0, 0.1)",borderRadius:"0.5rem",overflow:"hidden"},children:(0,n.jsx)("iframe",{src:r,title:"Προβολή Κάτοψης",width:"100%",height:"100%",style:{border:"none"},children:(0,n.jsxs)("p",{children:["Ο browser σας δεν υποστηρίζει την ενσωματωμένη προβολή PDF. Μπορείτε να το κατεβάσετε από",(0,n.jsxs)("a",{href:r,className:"text-primary hover:underline",download:!0,children:[" ","εδώ"]}),"."]})})}):(0,n.jsxs)("div",{className:"flex flex-col items-center justify-center h-40 border-2 border-dashed rounded-lg",children:[(0,n.jsx)("p",{className:"text-muted-foreground",children:"Δεν έχει ανεβεί κάτοψη για αυτόν τον όροφο."}),(0,n.jsx)("p",{className:"text-sm text-muted-foreground mt-2",children:"Παρακαλώ ανεβάστε ένα αρχείο PDF."})]})}function b(e){let{floorPlanUrl:t}=e;return(0,n.jsx)(m.Zb,{className:"p-0",children:(0,n.jsx)(m.aY,{className:"p-0",children:(0,n.jsx)(h,{pdfUrl:t})})})}var g=r(18473),x=r(87786),v=r(77209),y=r(58184);function j(e){let{onFileUpload:t,isUploading:r}=e,[s,o]=(0,i.useState)(null);return(0,n.jsxs)(m.Zb,{children:[(0,n.jsxs)(m.Ol,{children:[(0,n.jsx)(m.ll,{children:"Ανέβασμα Κάτοψης"}),(0,n.jsx)(m.SZ,{children:"Επιλέξτε ένα αρχείο PDF για να ανεβάσετε ως κάτοψη για αυτόν τον όροφο."})]}),(0,n.jsx)(m.aY,{children:(0,n.jsxs)("div",{className:"flex items-center gap-4",children:[(0,n.jsx)(v.I,{id:"pdf-upload",type:"file",accept:"application/pdf",onChange:e=>{e.target.files&&e.target.files.length>0&&o(e.target.files[0])},className:"flex-1"}),(0,n.jsxs)(u.z,{onClick:()=>{s&&t(s)},disabled:!s||r,children:[r?(0,n.jsx)(d.Z,{className:"mr-2 h-4 w-4 animate-spin"}):(0,n.jsx)(y.Z,{className:"mr-2 h-4 w-4"}),r?"Ανέβασμα...":"Ανέβασμα"]})]})})]})}function N(){let e=(0,s.useParams)(),t=(0,s.useRouter)(),r=e.id,{toast:u}=(0,c.pm)(),{user:f}=(0,x.a)(),[m,h]=(0,i.useState)(null),[v,y]=(0,i.useState)(!0),[N,w]=(0,i.useState)(!1);(0,i.useEffect)(()=>{if(!r)return;y(!0);let e=(0,o.JU)(a.db,"floors",r),n=(0,o.cf)(e,e=>{e.exists()?h({id:e.id,...e.data()}):(u({variant:"destructive",title:"Σφάλμα",description:"Ο όροφος δεν βρέθηκε."}),t.push("/buildings")),y(!1)},e=>{console.error("Error fetching floor:",e),u({variant:"destructive",title:"Error",description:"Failed to fetch floor details."}),y(!1)});return()=>{n()}},[r,t,u]);let I=async e=>{if(!e||!m||!f){u({variant:"destructive",title:"Σφάλμα",description:"Δεν βρέθηκαν οι απαραίτητες πληροφορίες (Όροφος, Χρήστης) για τη μεταφόρτωση."});return}w(!0);let t=(0,l.iH)(a.tO,"floor_plans/".concat(m.id,"/").concat(e.name));try{var r;await (0,l.KV)(t,e);let n=t.fullPath,i=(0,o.qs)(a.db),s=(0,o.JU)(a.db,"floors",m.id);i.update(s,{floorPlanUrl:n});let c=await (0,o.QT)((0,o.JU)(a.db,"buildings",m.buildingId));if(c.exists()){let e=c.data();if(e.projectId&&e.originalId&&m.originalId){let t=(0,o.JU)(a.db,"projects",e.projectId,"buildings",e.originalId,"floors",m.originalId);(await (0,o.QT)(t)).exists()?i.update(t,{floorPlanUrl:n}):console.warn("Subcollection floor document not found at: projects/".concat(e.projectId,"/buildings/").concat(e.originalId,"/floors/").concat(m.originalId))}else console.warn("Could not find all necessary IDs to update subcollection: projectId=".concat(e.projectId,", building.originalId=").concat(e.originalId,", floor.originalId=").concat(m.originalId))}await i.commit(),u({title:"Επιτυχία",description:"Η κάτοψη ανέβηκε."}),await (0,g.a)("UPLOAD_FLOORPLAN",{entityId:m.id,entityType:"floorplan",details:"Uploaded ".concat(e.name," for floor ").concat(m.level),projectId:null===(r=c.data())||void 0===r?void 0:r.projectId})}catch(e){console.error("Upload error:",e),u({variant:"destructive",title:"Σφάλμα",description:"Δεν ήταν δυνατή η μεταφόρτωση: ".concat(e.message)})}finally{w(!1)}};return v||!m?(0,n.jsx)("div",{className:"flex justify-center items-center h-full",children:(0,n.jsx)(d.Z,{className:"h-16 w-16 animate-spin text-muted-foreground"})}):(0,n.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,n.jsx)(p,{floor:m,onBack:()=>t.back()}),(0,n.jsx)(j,{onFileUpload:I,isUploading:N}),(0,n.jsx)(b,{floorPlanUrl:m.floorPlanUrl})]})}function w(){return(0,n.jsx)(N,{})}},89733:function(e,t,r){"use strict";r.d(t,{d:function(){return l},z:function(){return c}});var n=r(57437),i=r(2265),s=r(71538),o=r(13027),a=r(49354);let l=(0,o.j)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",destructive_outline:"border border-input text-destructive hover:bg-destructive/10",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),c=i.forwardRef((e,t)=>{let{className:r,variant:i,size:o,asChild:c=!1,...d}=e,u=c?s.g7:"button";return(0,n.jsx)(u,{className:(0,a.cn)(l({variant:i,size:o,className:r})),ref:t,...d})});c.displayName="Button"},48185:function(e,t,r){"use strict";r.d(t,{Ol:function(){return a},SZ:function(){return c},Zb:function(){return o},aY:function(){return d},eW:function(){return u},ll:function(){return l}});var n=r(57437),i=r(2265),s=r(49354);let o=i.forwardRef((e,t)=>{let{className:r,...i}=e;return(0,n.jsx)("div",{ref:t,className:(0,s.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",r),...i})});o.displayName="Card";let a=i.forwardRef((e,t)=>{let{className:r,...i}=e;return(0,n.jsx)("div",{ref:t,className:(0,s.cn)("flex flex-col space-y-1.5 p-6",r),...i})});a.displayName="CardHeader";let l=i.forwardRef((e,t)=>{let{className:r,...i}=e;return(0,n.jsx)("h3",{ref:t,className:(0,s.cn)("text-2xl font-semibold leading-none tracking-tight",r),...i})});l.displayName="CardTitle";let c=i.forwardRef((e,t)=>{let{className:r,...i}=e;return(0,n.jsx)("p",{ref:t,className:(0,s.cn)("text-sm text-muted-foreground",r),...i})});c.displayName="CardDescription";let d=i.forwardRef((e,t)=>{let{className:r,...i}=e;return(0,n.jsx)("div",{ref:t,className:(0,s.cn)("p-6 pt-0",r),...i})});d.displayName="CardContent";let u=i.forwardRef((e,t)=>{let{className:r,...i}=e;return(0,n.jsx)("div",{ref:t,className:(0,s.cn)("flex items-center p-6 pt-0",r),...i})});u.displayName="CardFooter"},77209:function(e,t,r){"use strict";r.d(t,{I:function(){return o}});var n=r(57437),i=r(2265),s=r(49354);let o=i.forwardRef((e,t)=>{let{className:r,type:i,...o}=e;return(0,n.jsx)("input",{type:i,className:(0,s.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",r),ref:t,...o})});o.displayName="Input"},87786:function(e,t,r){"use strict";r.d(t,{H:function(){return c},a:function(){return d}});var n=r(57437),i=r(2265),s=r(70303),o=r(89506),a=r(31721);let l=(0,i.createContext)({user:void 0,role:null,isLoading:!0,isAdmin:!1,isEditor:!1});function c(e){let{children:t}=e,[r,c]=(0,i.useState)(void 0),[d,u]=(0,i.useState)(null),[f,p]=(0,i.useState)(!0);return(0,i.useEffect)(()=>{let e=(0,s.Aj)(o.I8,async e=>{if(e){c(e);try{let t=await (0,a.zl)(e);u(t)}catch(e){console.error("Error finding or creating user document:",e),u(null)}finally{p(!1)}}else c(null),u(null),p(!1)});return()=>e()},[]),(0,n.jsx)(l.Provider,{value:{user:r,role:d,isLoading:f,isAdmin:"admin"===d,isEditor:"admin"===d||"editor"===d},children:t})}let d=()=>{let e=(0,i.useContext)(l);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},86763:function(e,t,r){"use strict";r.d(t,{pm:function(){return f}});var n=r(2265);let i=0,s=new Map,o=e=>{if(s.has(e))return;let t=setTimeout(()=>{s.delete(e),d({type:"REMOVE_TOAST",toastId:e})},1e6);s.set(e,t)},a=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:r}=t;return r?o(r):e.toasts.forEach(e=>{o(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===r||void 0===r?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}},l=[],c={toasts:[]};function d(e){c=a(c,e),l.forEach(e=>{e(c)})}function u(e){let{...t}=e,r=(i=(i+1)%Number.MAX_SAFE_INTEGER).toString(),n=()=>d({type:"DISMISS_TOAST",toastId:r});return d({type:"ADD_TOAST",toast:{...t,id:r,open:!0,onOpenChange:e=>{e||n()}}}),{id:r,dismiss:n,update:e=>d({type:"UPDATE_TOAST",toast:{...e,id:r}})}}function f(){let[e,t]=n.useState(c);return n.useEffect(()=>(l.push(t),()=>{let e=l.indexOf(t);e>-1&&l.splice(e,1)}),[e]),{...e,toast:u,dismiss:e=>d({type:"DISMISS_TOAST",toastId:e})}}},31721:function(e,t,r){"use strict";r.d(t,{CC:function(){return o},gX:function(){return l},hg:function(){return a},rr:function(){return i},zl:function(){return s}}),r(74590);var n=r(58064),i=(0,n.$)("650cf0f3f0bd18aeafc63b5f69071e5de8f11976"),s=(0,n.$)("7040ad050d67ddd3204a1b169328d1d9b63993a9"),o=(0,n.$)("bb940dc7dad8d371ecc54c42ecedc64f64a96fbe"),a=(0,n.$)("1929d9b4a55ccca6fd5c13ec1455093a8c2a1bfa");(0,n.$)("7c1778c43d4bcad59f28beb8c7aeb078136cdc4d"),(0,n.$)("948e70e8c58987240e5319b60bd1d6a596ff2cc9");var l=(0,n.$)("9569bcfade6c590b3d19ca071936f2c3b6bbf4e0")},89506:function(e,t,r){"use strict";r.d(t,{I8:function(){return u},db:function(){return d},tO:function(){return f}});var n=r(15236),i=r(69842),s=r(70303),o=r(57697),a=r(98298);let l={apiKey:"AIzaSyALXvVaqDt2xuX5E8uRIyoBzl9n4WQHLa4",authDomain:"tasia-6f77i.firebaseapp.com",projectId:"tasia-6f77i",storageBucket:"tasia-6f77i.appspot.com",messagingSenderId:"204877276202",appId:"1:204877276202:web:31db4eb5b1c1b7c4078f53",measurementId:r(25566).env.NEXT_PUBLIC_FIREBASE_MEASUREMENT_ID};l&&l.apiKey&&l.projectId||console.error("Firebase configuration is missing. Make sure your environment variables are set up correctly and passed through next.config.js.");let c=(0,n.C6)().length?(0,n.Mq)():(0,n.ZF)(l),d=(0,i.ad)(c),u=(0,s.v0)(c),f=(0,o.cF)(c);(0,a.$C)(c),(0,i.ST)(d).then(()=>console.log("Firestore offline persistence enabled.")).catch(e=>{"failed-precondition"==e.code?console.warn("Firestore persistence failed: Multiple tabs open."):"unimplemented"==e.code&&console.warn("Firestore persistence not supported in this browser.")})},18473:function(e,t,r){"use strict";r.d(t,{a:function(){return s}});var n=r(69842),i=r(89506);let s=async(e,t)=>{try{let r=i.I8.currentUser;if(!r){console.warn("Cannot log activity: User is not authenticated.");return}let s={action:e,...t,userId:r.uid,userEmail:r.email,timestamp:(0,n.Bt)()};await (0,n.ET)((0,n.hJ)(i.db,"auditLogs"),s)}catch(e){console.error("Failed to write to audit log:",e)}}},49354:function(e,t,r){"use strict";r.d(t,{cn:function(){return s}});var n=r(44839),i=r(96164);function s(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,i.m6)((0,n.W)(t))}},1584:function(e,t,r){"use strict";r.d(t,{F:function(){return s},e:function(){return o}});var n=r(2265);function i(e,t){if("function"==typeof e)return e(t);null!=e&&(e.current=t)}function s(...e){return t=>{let r=!1,n=e.map(e=>{let n=i(e,t);return r||"function"!=typeof n||(r=!0),n});if(r)return()=>{for(let t=0;t<n.length;t++){let r=n[t];"function"==typeof r?r():i(e[t],null)}}}}function o(...e){return n.useCallback(s(...e),e)}},71538:function(e,t,r){"use strict";r.d(t,{Z8:function(){return o},g7:function(){return a},sA:function(){return c}});var n=r(2265),i=r(1584),s=r(57437);function o(e){let t=function(e){let t=n.forwardRef((e,t)=>{let{children:r,...s}=e;if(n.isValidElement(r)){let e,o;let a=(e=Object.getOwnPropertyDescriptor(r.props,"ref")?.get)&&"isReactWarning"in e&&e.isReactWarning?r.ref:(e=Object.getOwnPropertyDescriptor(r,"ref")?.get)&&"isReactWarning"in e&&e.isReactWarning?r.props.ref:r.props.ref||r.ref,l=function(e,t){let r={...t};for(let n in t){let i=e[n],s=t[n];/^on[A-Z]/.test(n)?i&&s?r[n]=(...e)=>{let t=s(...e);return i(...e),t}:i&&(r[n]=i):"style"===n?r[n]={...i,...s}:"className"===n&&(r[n]=[i,s].filter(Boolean).join(" "))}return{...e,...r}}(s,r.props);return r.type!==n.Fragment&&(l.ref=t?(0,i.F)(t,a):a),n.cloneElement(r,l)}return n.Children.count(r)>1?n.Children.only(null):null});return t.displayName=`${e}.SlotClone`,t}(e),r=n.forwardRef((e,r)=>{let{children:i,...o}=e,a=n.Children.toArray(i),l=a.find(d);if(l){let e=l.props.children,i=a.map(t=>t!==l?t:n.Children.count(e)>1?n.Children.only(null):n.isValidElement(e)?e.props.children:null);return(0,s.jsx)(t,{...o,ref:r,children:n.isValidElement(e)?n.cloneElement(e,void 0,i):null})}return(0,s.jsx)(t,{...o,ref:r,children:i})});return r.displayName=`${e}.Slot`,r}var a=o("Slot"),l=Symbol("radix.slottable");function c(e){let t=({children:e})=>(0,s.jsx)(s.Fragment,{children:e});return t.displayName=`${e}.Slottable`,t.__radixId=l,t}function d(e){return n.isValidElement(e)&&"function"==typeof e.type&&"__radixId"in e.type&&e.type.__radixId===l}},13027:function(e,t,r){"use strict";r.d(t,{j:function(){return o}});var n=r(44839);let i=e=>"boolean"==typeof e?`${e}`:0===e?"0":e,s=n.W,o=(e,t)=>r=>{var n;if((null==t?void 0:t.variants)==null)return s(e,null==r?void 0:r.class,null==r?void 0:r.className);let{variants:o,defaultVariants:a}=t,l=Object.keys(o).map(e=>{let t=null==r?void 0:r[e],n=null==a?void 0:a[e];if(null===t)return null;let s=i(t)||i(n);return o[e][s]}),c=r&&Object.entries(r).reduce((e,t)=>{let[r,n]=t;return void 0===n||(e[r]=n),e},{});return s(e,l,null==t?void 0:null===(n=t.compoundVariants)||void 0===n?void 0:n.reduce((e,t)=>{let{class:r,className:n,...i}=t;return Object.entries(i).every(e=>{let[t,r]=e;return Array.isArray(r)?r.includes({...a,...c}[t]):({...a,...c})[t]===r})?[...e,r,n]:e},[]),null==r?void 0:r.class,null==r?void 0:r.className)}}},function(e){e.O(0,[3609,9015,8502,1080,2971,7023,1744],function(){return e(e.s=56770)}),_N_E=e.O()}]);