(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3732],{69637:function(e,t,s){Promise.resolve().then(s.bind(s,11058))},11058:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return e$}});var l=s(57437),r=s(2265),a=s(16463),n=s(69842),i=s(89506),d=s(3274),o=s(89733),c=s(95137),u=s(48185),x=s(79055),m=s(66648),h=s(6460);let j=e=>{if(!e)return"-";let t=e instanceof n.EK?e.toDate():e;return(0,h.WU)(t,"dd/MM/yyyy")};function p(e){let{project:t}=e;return(0,l.jsxs)(u.Zb,{children:[(0,l.jsxs)(u.Ol,{children:[(0,l.jsx)(u.ll,{children:t.title}),(0,l.jsxs)(u.SZ,{children:[t.location," | Προθεσμία: ",j(t.deadline)," | Κατάσταση: ",t.status]})]}),(0,l.jsxs)(u.aY,{className:"flex flex-col gap-6 md:flex-row",children:[t.photoUrl&&(0,l.jsx)("div",{className:"md:w-1/3 relative aspect-[4/3]",children:(0,l.jsx)(m.default,{src:t.photoUrl,alt:"Photo of ".concat(t.title),fill:!0,className:"rounded-lg object-contain",sizes:"(max-width: 768px) 100vw, 33vw",loading:"lazy"})}),(0,l.jsxs)("div",{className:"flex-1 space-y-4",children:[t.description&&(0,l.jsx)("p",{className:"text-sm text-muted-foreground",children:t.description}),t.tags&&t.tags.length>0&&(0,l.jsx)("div",{className:"flex flex-wrap gap-2",children:t.tags.map(e=>(0,l.jsx)(x.C,{variant:"secondary",children:e},e))})]})]})]})}var f=s(86864),g=s(47304),v=s(29943),N=s(39343),b=s(31014),w=s(96273),y=s(6649),k=s(10883),C=s(86763),S=s(18473),I=s(3187),U=s(87786);function z(e){let{project:t}=e,s=(0,a.useRouter)(),{toast:c}=(0,C.pm)(),{isEditor:x}=(0,U.a)(),[j,p]=(0,r.useState)([]),[f,z]=(0,r.useState)(!0),[D,Z]=(0,r.useState)(!1),[J,E]=(0,r.useState)(!1),[W,L]=(0,r.useState)(null),T=(0,N.cI)({resolver:(0,b.F)(I.h),defaultValues:{id:void 0,address:"",type:"",description:"",photoUrl:"",floorsCount:void 0,constructionYear:void 0,tags:"",identifier:""}});(0,r.useEffect)(()=>{if(!t.id)return;let e=(0,n.hJ)(i.db,"projects",t.id,"buildings"),s=(0,n.cf)(e,e=>{p(e.docs.map(e=>({id:e.id,...e.data()}))),z(!1)},e=>{console.error("Error fetching buildings: ",e),c({variant:"destructive",title:"Σφάλμα",description:"Δεν ήταν δυνατή η φόρτωση των κτιρίων."}),z(!1)});return()=>s()},[t.id,c]);let A=e=>{E(e),e||(T.reset(),L(null))},P=async e=>{let t=(0,n.JU)(i.db,"buildings",e.topLevelId),s=await (0,n.QT)(t);if(s.exists()){let t=s.data();T.reset({id:e.id,address:t.address,type:t.type,description:t.description||"",photoUrl:t.photoUrl||"",floorsCount:t.floorsCount||void 0,constructionYear:t.constructionYear||void 0,tags:(t.tags||[]).join(", "),identifier:t.identifier||""}),L(e),E(!0)}else c({variant:"destructive",title:"Σφάλμα",description:"Could not find building details."})},R=async e=>{let s=j.find(t=>t.id===e);if(s)try{let e=(0,n.qs)(i.db);e.delete((0,n.JU)(i.db,"buildings",s.topLevelId)),e.delete((0,n.JU)(i.db,"projects",t.id,"buildings",s.id)),await e.commit(),c({title:"Επιτυχία",description:"Το κτίριο διαγράφηκε."}),await (0,S.a)("DELETE_BUILDING",{entityId:s.topLevelId,entityType:"building",details:{address:s.address},projectId:t.id})}catch(e){console.error("Error deleting building:",e),c({variant:"destructive",title:"Σφάλμα",description:"Δεν ήταν δυνατή η διαγραφή του κτιρίου."})}},_=async e=>{var s;Z(!0);let l={address:e.address,type:e.type,description:e.description||"",photoUrl:(null===(s=e.photoUrl)||void 0===s?void 0:s.trim())||void 0,floorsCount:e.floorsCount||void 0,constructionYear:e.constructionYear||void 0,tags:e.tags?e.tags.split(",").map(e=>e.trim()).filter(Boolean):[],identifier:e.identifier};try{if(W){let e=(0,n.qs)(i.db);e.update((0,n.JU)(i.db,"buildings",W.topLevelId),l),e.update((0,n.JU)(i.db,"projects",t.id,"buildings",W.id),{address:l.address,type:l.type,description:l.description,photoUrl:l.photoUrl}),await e.commit(),c({title:"Επιτυχία",description:"Το κτίριο ενημερώθηκε."}),await (0,S.a)("UPDATE_BUILDING",{entityId:W.topLevelId,entityType:"building",changes:l,projectId:t.id})}else{let e=(0,n.qs)(i.db),s=(0,n.JU)((0,n.hJ)(i.db,"buildings")),r=(0,n.JU)((0,n.hJ)(i.db,"projects",t.id,"buildings"));e.set(s,{...l,projectId:t.id,originalId:r.id,createdAt:(0,n.Bt)()}),e.set(r,{address:l.address,type:l.type,description:l.description,photoUrl:l.photoUrl,topLevelId:s.id,createdAt:(0,n.Bt)()}),await e.commit(),c({title:"Επιτυχία",description:"Το κτίριο προστέθηκε."}),await (0,S.a)("CREATE_BUILDING",{entityId:s.id,entityType:"building",details:l,projectId:t.id})}A(!1)}catch(e){console.error("Error submitting building: ",e),c({variant:"destructive",title:"Σφάλμα",description:"Δεν ήταν δυνατή η υποβολή."})}finally{Z(!1)}},O=e=>e?(0,h.WU)(e.toDate(),"dd/MM/yyyy"):"-";return(0,l.jsxs)(u.Zb,{children:[(0,l.jsx)(u.Ol,{children:(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsx)(u.ll,{children:"Κτίρια του Έργου"}),x&&(0,l.jsxs)(o.z,{size:"sm",onClick:()=>{L(null),T.reset(),E(!0)},children:[(0,l.jsx)(w.Z,{className:"mr-2"}),"Νέο Κτίριο"]})]})}),(0,l.jsx)(u.aY,{children:f?(0,l.jsx)("div",{className:"flex justify-center items-center h-40",children:(0,l.jsx)(d.Z,{className:"h-8 w-8 animate-spin text-muted-foreground"})}):j.length>0?(0,l.jsx)("div",{className:"w-full overflow-x-auto",children:(0,l.jsxs)(g.iA,{children:[(0,l.jsx)(g.xD,{children:(0,l.jsxs)(g.SC,{children:[(0,l.jsx)(g.ss,{className:"w-[60px]",children:"Φωτο"}),(0,l.jsx)(g.ss,{children:"Διεύθυνση"}),(0,l.jsx)(g.ss,{children:"Τύπος"}),(0,l.jsx)(g.ss,{children:"Ημ/νία Δημ."}),(0,l.jsx)(g.ss,{className:"text-right",children:"Ενέργειες"})]})}),(0,l.jsx)(g.RM,{children:j.map(e=>(0,l.jsxs)(g.SC,{className:"group",children:[(0,l.jsx)(g.pj,{children:(0,l.jsx)("div",{className:"cursor-pointer w-10 h-10 relative",onClick:()=>s.push("/buildings/".concat(e.topLevelId)),children:e.photoUrl?(0,l.jsx)(m.default,{src:e.photoUrl,alt:e.address,fill:!0,className:"rounded-md object-cover",sizes:"40px"}):(0,l.jsx)("div",{className:"w-10 h-10 bg-muted rounded-md flex items-center justify-center text-muted-foreground text-xs",children:"N/A"})})}),(0,l.jsx)(g.pj,{className:"font-medium cursor-pointer",onClick:()=>s.push("/buildings/".concat(e.topLevelId)),children:e.address}),(0,l.jsx)(g.pj,{className:"text-muted-foreground cursor-pointer",onClick:()=>s.push("/buildings/".concat(e.topLevelId)),children:e.type}),(0,l.jsx)(g.pj,{className:"cursor-pointer",onClick:()=>s.push("/buildings/".concat(e.topLevelId)),children:O(e.createdAt)}),(0,l.jsx)(g.pj,{className:"text-right",children:x&&(0,l.jsxs)("div",{className:"opacity-0 group-hover:opacity-100 transition-opacity flex justify-end gap-2",children:[(0,l.jsxs)(o.z,{variant:"ghost",size:"icon",title:"Επεξεργασία",onClick:t=>{t.stopPropagation(),P(e)},children:[(0,l.jsx)(y.Z,{className:"h-4 w-4"}),(0,l.jsx)("span",{className:"sr-only",children:"Επεξεργασία"})]}),(0,l.jsxs)(v.aR,{children:[(0,l.jsx)(v.vW,{asChild:!0,children:(0,l.jsxs)(o.z,{variant:"ghost",size:"icon",title:"Διαγραφή",className:"text-destructive hover:text-destructive",onClick:e=>e.stopPropagation(),children:[(0,l.jsx)(k.Z,{className:"h-4 w-4"}),(0,l.jsx)("span",{className:"sr-only",children:"Διαγραφή"})]})}),(0,l.jsxs)(v._T,{children:[(0,l.jsxs)(v.fY,{children:[(0,l.jsx)(v.f$,{children:"Είστε σίγουροι;"}),(0,l.jsxs)(v.yT,{children:['Αυτή η ενέργεια δεν μπορεί να αναιρεθεί. Θα διαγραφεί οριστικά το κτίριο "',e.address,'" και όλοι οι όροφοι και τα ακίνητα που περιέχει.']})]}),(0,l.jsxs)(v.xo,{children:[(0,l.jsx)(v.le,{children:"Ακύρωση"}),(0,l.jsx)(v.OL,{onClick:()=>R(e.id),className:"bg-destructive hover:bg-destructive/90",children:"Διαγραφή"})]})]})]})]})})]},e.id))})]})}):(0,l.jsx)("p",{className:"text-center text-muted-foreground py-8",children:"Δεν βρέθηκαν κτίρια για αυτό το έργο."})}),x&&(0,l.jsx)(I.$,{open:J,onOpenChange:A,form:T,onSubmit:T.handleSubmit(_),isSubmitting:D,editingBuilding:W})]})}var D=s(37164),Z=s(10371),J=s(57697),E=s(59917);let W=E.Ry({id:E.Z_().optional(),name:E.Z_().min(1,"Το όνομα είναι υποχρεωτικό."),description:E.Z_().optional(),status:E.Km(["Εκκρεμεί","Σε εξέλιξη","Ολοκληρώθηκε","Καθυστερεί"]),assignedTo:E.Z_().optional(),relatedEntityIds:E.Z_().optional(),dependsOn:E.Z_().optional(),notes:E.Z_().optional(),startDate:E.hT().optional().nullable(),endDate:E.hT().optional().nullable(),deadline:E.hT().optional().nullable(),documents:E.Z_().optional(),budgetedCost:E.Z_().optional(),actualCost:E.Z_().optional()});var L=s(89277);let T=e=>{if(!e)return"-";let t=e instanceof n.EK?e.toDate():e;return(0,h.WU)(t,"dd/MM/yyyy")},A=e=>{switch(e){case"Ολοκληρώθηκε":return"default";case"Σε εξέλιξη":return"secondary";case"Καθυστερεί":return"destructive";default:return"outline"}},P=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;return e&&0!==e.length?e.map(e=>{var s;return(null===(s=t.find(t=>t.id===e))||void 0===s?void 0:s.name)||e}).join(", "):"Κανένας"},R=e=>null==e?"-":"€".concat(e.toLocaleString("el-GR",{minimumFractionDigits:2,maximumFractionDigits:2})),_=e=>e&&0!==e.length?e.filter(e=>e.completed).length/e.length*100:0,O=e=>{var t;let s=_(e.checklist);return(null===(t=e.workSubstages)||void 0===t?void 0:t.length)>0?.5*s+e.workSubstages.map(e=>_(e.checklist)).reduce((e,t)=>e+t,0)/e.workSubstages.length*.5:s};var G=s(54662),X=s(93363),Y=s(77209),B=s(4919),M=s(24241),V=s(2128),q=s(21413),K=s(69081),F=s(49354),Q=s(96153);function $(e){let{open:t,onOpenChange:s,form:r,onSubmit:a,isSubmitting:n,editingWorkStage:i,companies:c,isLoadingCompanies:u}=e;return(0,l.jsx)(G.Vq,{open:t,onOpenChange:s,children:(0,l.jsxs)(G.cZ,{className:"sm:max-w-lg",children:[(0,l.jsx)(G.fK,{children:(0,l.jsxs)(G.$N,{children:[i&&"id"in i?"Επεξεργασία":"Νέο"," ",i&&"parentId"in i?"Υποστάδιο Εργασίας":"Στάδιο Εργασίας"]})}),(0,l.jsx)(X.l0,{...r,children:(0,l.jsxs)("form",{onSubmit:a,className:"grid max-h-[80vh] gap-4 overflow-y-auto py-4 pr-4",children:[(0,l.jsx)(X.Wi,{control:r.control,name:"name",render:e=>{let{field:t}=e;return(0,l.jsxs)(X.xJ,{children:[(0,l.jsx)(X.lX,{children:"Όνομα"}),(0,l.jsx)(X.NI,{children:(0,l.jsx)(Y.I,{...t})}),(0,l.jsx)(X.zG,{})]})}}),(0,l.jsx)(X.Wi,{control:r.control,name:"description",render:e=>{let{field:t}=e;return(0,l.jsxs)(X.xJ,{children:[(0,l.jsx)(X.lX,{children:"Περιγραφή"}),(0,l.jsx)(X.NI,{children:(0,l.jsx)(B.g,{...t})}),(0,l.jsx)(X.zG,{})]})}}),(0,l.jsx)(X.Wi,{control:r.control,name:"status",render:e=>{let{field:t}=e;return(0,l.jsxs)(X.xJ,{children:[(0,l.jsx)(X.lX,{children:"Κατάσταση"}),(0,l.jsxs)(V.Ph,{onValueChange:t.onChange,defaultValue:t.value,children:[(0,l.jsx)(X.NI,{children:(0,l.jsx)(V.i4,{children:(0,l.jsx)(V.ki,{})})}),(0,l.jsxs)(V.Bw,{children:[(0,l.jsx)(V.Ql,{value:"Εκκρεμεί",children:"Εκκρεμεί"}),(0,l.jsx)(V.Ql,{value:"Σε εξέλιξη",children:"Σε εξέλιξη"}),(0,l.jsx)(V.Ql,{value:"Ολοκληρώθηκε",children:"Ολοκληρώθηκε"}),(0,l.jsx)(V.Ql,{value:"Καθυστερεί",children:"Καθυστερεί"})]})]}),(0,l.jsx)(X.zG,{})]})}}),(0,l.jsxs)("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[(0,l.jsx)(X.Wi,{control:r.control,name:"budgetedCost",render:e=>{let{field:t}=e;return(0,l.jsxs)(X.xJ,{children:[(0,l.jsx)(X.lX,{children:"Προϋπολογισμένο Κόστος (€)"}),(0,l.jsx)(X.NI,{children:(0,l.jsx)(Y.I,{type:"number",...t})}),(0,l.jsx)(X.zG,{})]})}}),(0,l.jsx)(X.Wi,{control:r.control,name:"actualCost",render:e=>{let{field:t}=e;return(0,l.jsxs)(X.xJ,{children:[(0,l.jsx)(X.lX,{children:"Πραγματικό Κόστος (€)"}),(0,l.jsx)(X.NI,{children:(0,l.jsx)(Y.I,{type:"number",...t})}),(0,l.jsx)(X.zG,{})]})}})]}),(0,l.jsx)(X.Wi,{control:r.control,name:"assignedTo",render:e=>{let{field:t}=e;return(0,l.jsxs)(X.xJ,{children:[(0,l.jsx)(X.lX,{children:"Ανάθεση σε"}),(0,l.jsxs)(V.Ph,{onValueChange:t.onChange,defaultValue:t.value,children:[(0,l.jsx)(X.NI,{children:(0,l.jsx)(V.i4,{children:(0,l.jsx)(V.ki,{placeholder:"Επιλέξτε υπεύθυνο..."})})}),(0,l.jsxs)(V.Bw,{children:[(0,l.jsx)(V.Ql,{value:"",children:(0,l.jsx)("em",{children:"Κανένας"})}),u?(0,l.jsx)("div",{className:"flex items-center justify-center p-2",children:(0,l.jsx)(d.Z,{className:"h-4 w-4 animate-spin"})}):c.map(e=>(0,l.jsx)(V.Ql,{value:e.id,children:e.name},e.id))]})]}),(0,l.jsx)(X.zG,{})]})}}),(0,l.jsx)(X.Wi,{control:r.control,name:"relatedEntityIds",render:e=>{let{field:t}=e;return(0,l.jsxs)(X.xJ,{children:[(0,l.jsx)(X.lX,{children:"Αφορά (IDs κτιρίων/ορόφων/ακινήτων με κόμμα)"}),(0,l.jsx)(X.NI,{children:(0,l.jsx)(Y.I,{...t,placeholder:"π.χ. ID κτιρίου, ID ακινήτου..."})}),(0,l.jsx)(X.zG,{})]})}}),(0,l.jsx)(X.Wi,{control:r.control,name:"dependsOn",render:e=>{let{field:t}=e;return(0,l.jsxs)(X.xJ,{children:[(0,l.jsx)(X.lX,{children:"Εξαρτάται από (IDs σταδίων με κόμμα)"}),(0,l.jsx)(X.NI,{children:(0,l.jsx)(Y.I,{...t,placeholder:"π.χ. ID σταδίου, ID υποσταδίου..."})}),(0,l.jsx)(X.zG,{})]})}}),(0,l.jsx)(X.Wi,{control:r.control,name:"documents",render:e=>{let{field:t}=e;return(0,l.jsxs)(X.xJ,{children:[(0,l.jsx)(X.lX,{children:"Απαιτούμενα Έγγραφα"}),(0,l.jsx)(X.NI,{children:(0,l.jsx)(B.g,{...t,placeholder:"π.χ. Σχέδια, Άδεια Δόμησης...",rows:3})}),(0,l.jsx)(X.pf,{children:"Καταχωρήστε ένα όνομα εγγράφου ανά γραμμή."}),(0,l.jsx)(X.zG,{})]})}}),(0,l.jsx)(X.Wi,{control:r.control,name:"notes",render:e=>{let{field:t}=e;return(0,l.jsxs)(X.xJ,{children:[(0,l.jsx)(X.lX,{children:"Σημειώσεις"}),(0,l.jsx)(X.NI,{children:(0,l.jsx)(B.g,{...t})}),(0,l.jsx)(X.zG,{})]})}}),(0,l.jsxs)("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-3",children:[(0,l.jsx)(X.Wi,{control:r.control,name:"startDate",render:e=>{var t;let{field:s}=e;return(0,l.jsxs)(X.xJ,{children:[(0,l.jsx)(X.lX,{children:"Έναρξη"}),(0,l.jsxs)(q.J2,{children:[(0,l.jsx)(q.xo,{asChild:!0,children:(0,l.jsx)(X.NI,{children:(0,l.jsxs)(o.z,{variant:"outline",className:(0,F.cn)("w-full pl-3 text-left font-normal",!s.value&&"text-muted-foreground"),children:[s.value?(0,h.WU)(s.value,"P",{locale:Q.el}):(0,l.jsx)("span",{children:"Επιλογή"}),(0,l.jsx)(M.Z,{className:"ml-auto h-4 w-4 opacity-50"})]})})}),(0,l.jsx)(q.yk,{className:"w-auto p-0",align:"start",children:(0,l.jsx)(K.f,{mode:"single",selected:null!==(t=s.value)&&void 0!==t?t:void 0,onSelect:s.onChange,initialFocus:!0})})]}),(0,l.jsx)(X.zG,{})]})}}),(0,l.jsx)(X.Wi,{control:r.control,name:"endDate",render:e=>{var t;let{field:s}=e;return(0,l.jsxs)(X.xJ,{children:[(0,l.jsx)(X.lX,{children:"Λήξη"}),(0,l.jsxs)(q.J2,{children:[(0,l.jsx)(q.xo,{asChild:!0,children:(0,l.jsx)(X.NI,{children:(0,l.jsxs)(o.z,{variant:"outline",className:(0,F.cn)("w-full pl-3 text-left font-normal",!s.value&&"text-muted-foreground"),children:[s.value?(0,h.WU)(s.value,"P",{locale:Q.el}):(0,l.jsx)("span",{children:"Επιλογή"}),(0,l.jsx)(M.Z,{className:"ml-auto h-4 w-4 opacity-50"})]})})}),(0,l.jsx)(q.yk,{className:"w-auto p-0",align:"start",children:(0,l.jsx)(K.f,{mode:"single",selected:null!==(t=s.value)&&void 0!==t?t:void 0,onSelect:s.onChange,initialFocus:!0})})]}),(0,l.jsx)(X.zG,{})]})}}),(0,l.jsx)(X.Wi,{control:r.control,name:"deadline",render:e=>{var t;let{field:s}=e;return(0,l.jsxs)(X.xJ,{children:[(0,l.jsx)(X.lX,{children:"Προθεσμία"}),(0,l.jsxs)(q.J2,{children:[(0,l.jsx)(q.xo,{asChild:!0,children:(0,l.jsx)(X.NI,{children:(0,l.jsxs)(o.z,{variant:"outline",className:(0,F.cn)("w-full pl-3 text-left font-normal",!s.value&&"text-muted-foreground"),children:[s.value?(0,h.WU)(s.value,"P",{locale:Q.el}):(0,l.jsx)("span",{children:"Επιλογή"}),(0,l.jsx)(M.Z,{className:"ml-auto h-4 w-4 opacity-50"})]})})}),(0,l.jsx)(q.yk,{className:"w-auto p-0",align:"start",children:(0,l.jsx)(K.f,{mode:"single",selected:null!==(t=s.value)&&void 0!==t?t:void 0,onSelect:s.onChange,initialFocus:!0})})]}),(0,l.jsx)(X.zG,{})]})}})]}),(0,l.jsxs)(G.cN,{children:[(0,l.jsx)(G.GG,{asChild:!0,children:(0,l.jsx)(o.z,{type:"button",variant:"outline",disabled:n,children:"Ακύρωση"})}),(0,l.jsxs)(o.z,{type:"submit",disabled:n,children:[n&&(0,l.jsx)(d.Z,{className:"mr-2 h-4 w-4 animate-spin"}),"Αποθήκευση"]})]})]})})]})})}var H=s(35265),ee=s(61617);let et=r.memo(function(e){let{stage:t,isSubstage:s}=e,a=(0,r.useMemo)(()=>O(t),[t]);return(0,l.jsxs)("div",{className:"flex items-center gap-4 flex-1",children:[(0,l.jsx)(x.C,{variant:A(t.status),children:t.status}),(0,l.jsx)("span",{className:"font-bold text-base",children:t.name}),(0,l.jsxs)("div",{className:"flex items-center gap-2 ml-auto w-32",children:[(0,l.jsx)(ee.E,{value:a,className:"h-2 flex-1"}),(0,l.jsxs)("span",{className:"text-xs font-mono text-muted-foreground",children:[Math.round(a),"%"]})]})]})});var es=s(76780),el=s(52022),er=s(92940),ea=s(40933),en=s(51077),ei=s(25912),ed=s(52449),eo=s(71322),ec=s(17673),eu=s(44541),ex=s(70402),em=s(22023),eh=s(47390),ej=s(92513);function ep(e){var t;let{stage:s,onToggle:a,onAdd:n,onNotesChange:i}=e,[d,c]=(0,r.useState)(""),u=(0,r.useMemo)(()=>_(s.checklist),[s.checklist]),x=()=>{d.trim()&&(n(d.trim()),c(""))},m=e=>{var t;return null===(t=s.documents)||void 0===t?void 0:t.includes(e)};return(0,l.jsxs)("div",{className:"mt-4 space-y-3",children:[(0,l.jsx)("h4",{className:"font-semibold",children:"Checklist Επιθεώρησης & Εγγράφων"}),s.checklist&&s.checklist.length>0&&(0,l.jsxs)("div",{children:[(0,l.jsx)(ee.E,{value:u,className:"w-full h-2"}),(0,l.jsxs)("p",{className:"text-xs text-muted-foreground mt-1 text-right",children:[Math.round(u),"% Ολοκληρώθηκε"]})]}),(0,l.jsx)("div",{className:"space-y-2",children:null===(t=s.checklist)||void 0===t?void 0:t.map((e,t)=>(0,l.jsxs)("div",{className:"flex flex-col gap-2 bg-muted/50 p-3 rounded-md",children:[(0,l.jsxs)("div",{className:"flex items-center gap-3",children:[(0,l.jsx)(eu.X,{id:"task-".concat(s.id,"-").concat(t),checked:e.completed,onCheckedChange:e=>a(t,!!e),disabled:m(e.task)}),(0,l.jsxs)(ex._,{htmlFor:"task-".concat(s.id,"-").concat(t),className:"flex-1 flex items-center gap-2 ".concat(e.completed?"line-through text-muted-foreground":""),children:[m(e.task)&&(0,l.jsx)(em.Z,{className:"h-4 w-4 text-muted-foreground"}),e.task]})]}),e.completed&&e.completedBy&&(0,l.jsxs)("p",{className:"text-xs text-muted-foreground pl-8",children:["Ολοκληρώθηκε από ",e.completedBy," στις"," ",T(e.completionDate)]}),(0,l.jsxs)("div",{className:"pl-8 flex items-center gap-2",children:[(0,l.jsx)(eh.Z,{className:"h-4 w-4 text-muted-foreground"}),(0,l.jsx)(Y.I,{placeholder:"Προσθήκη παρατηρήσεων επιθεώρησης...",defaultValue:e.inspectionNotes||"",onBlur:e=>i(t,e.target.value),className:"h-8 text-xs flex-1"})]})]},t))}),(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)(Y.I,{value:d,onChange:e=>c(e.target.value),placeholder:"Νέα εργασία επιθεώρησης...",onKeyDown:e=>"Enter"===e.key&&x()}),(0,l.jsxs)(o.z,{size:"sm",onClick:x,children:[(0,l.jsx)(ej.Z,{className:"mr-2 h-4 w-4"}),"Προσθήκη Εργασίας"]})]})]})}let ef=(0,s(13027).j)("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),eg=r.forwardRef((e,t)=>{let{className:s,variant:r,...a}=e;return(0,l.jsx)("div",{ref:t,role:"alert",className:(0,F.cn)(ef({variant:r}),s),...a})});eg.displayName="Alert";let ev=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,l.jsx)("h5",{ref:t,className:(0,F.cn)("mb-1 font-medium leading-none tracking-tight",s),...r})});ev.displayName="AlertTitle";let eN=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,l.jsx)("div",{ref:t,className:(0,F.cn)("text-sm [&_p]:leading-relaxed",s),...r})});eN.displayName="AlertDescription";var eb=s(74300),ew=s(71976);let ey=r.createContext(null);function ek(){let e=r.useContext(ey);if(!e)throw Error("useCarousel must be used within a <Carousel />");return e}let eC=r.forwardRef((e,t)=>{let{orientation:s="horizontal",opts:a,setApi:n,plugins:i,className:d,children:o,...c}=e,[u,x]=(0,eb.Z)({...a,axis:"horizontal"===s?"x":"y"},i),[m,h]=r.useState(!1),[j,p]=r.useState(!1),f=r.useCallback(e=>{e&&(h(e.canScrollPrev()),p(e.canScrollNext()))},[]),g=r.useCallback(()=>{null==x||x.scrollPrev()},[x]),v=r.useCallback(()=>{null==x||x.scrollNext()},[x]),N=r.useCallback(e=>{"ArrowLeft"===e.key?(e.preventDefault(),g()):"ArrowRight"===e.key&&(e.preventDefault(),v())},[g,v]);return r.useEffect(()=>{if(x)return f(x),x.on("reInit",f),x.on("select",f),()=>{null==x||x.off("select",f)}},[x,f]),(0,l.jsx)(ey.Provider,{value:{carouselRef:u,api:x,opts:a,orientation:s,scrollPrev:g,scrollNext:v,canScrollPrev:m,canScrollNext:j},children:(0,l.jsx)("div",{ref:t,onKeyDownCapture:N,className:(0,F.cn)("relative",d),role:"region","aria-roledescription":"carousel",...c,children:o})})});eC.displayName="Carousel";let eS=r.forwardRef((e,t)=>{let{className:s,...r}=e,{carouselRef:a,orientation:n}=ek();return(0,l.jsx)("div",{ref:a,className:"overflow-hidden",children:(0,l.jsx)("div",{ref:t,className:(0,F.cn)("flex","horizontal"===n?"-ml-4":"-mt-4 flex-col",s),...r})})});eS.displayName="CarouselContent";let eI=r.forwardRef((e,t)=>{let{className:s,...r}=e,{orientation:a}=ek();return(0,l.jsx)("div",{ref:t,role:"group","aria-roledescription":"slide",className:(0,F.cn)("min-w-0 shrink-0 grow-0 basis-full","horizontal"===a?"pl-4":"pt-4",s),...r})});eI.displayName="CarouselItem";let eU=r.forwardRef((e,t)=>{let{className:s,variant:r="outline",size:a="icon",...n}=e,{orientation:i,scrollPrev:d,canScrollPrev:u}=ek();return(0,l.jsxs)(o.z,{ref:t,variant:r,size:a,className:(0,F.cn)("absolute  h-8 w-8 rounded-full","horizontal"===i?"-left-12 top-1/2 -translate-y-1/2":"-top-12 left-1/2 -translate-x-1/2 rotate-90",s),disabled:!u,onClick:d,...n,children:[(0,l.jsx)(c.Z,{className:"h-4 w-4"}),(0,l.jsx)("span",{className:"sr-only",children:"Previous slide"})]})});eU.displayName="CarouselPrevious";let ez=r.forwardRef((e,t)=>{let{className:s,variant:r="outline",size:a="icon",...n}=e,{orientation:i,scrollNext:d,canScrollNext:c}=ek();return(0,l.jsxs)(o.z,{ref:t,variant:r,size:a,className:(0,F.cn)("absolute h-8 w-8 rounded-full","horizontal"===i?"-right-12 top-1/2 -translate-y-1/2":"-bottom-12 left-1/2 -translate-x-1/2 rotate-90",s),disabled:!c,onClick:d,...n,children:[(0,l.jsx)(ew.Z,{className:"h-4 w-4"}),(0,l.jsx)("span",{className:"sr-only",children:"Next slide"})]})});ez.displayName="CarouselNext";var eD=s(58184),eZ=s(44828),eJ=s(77076);let eE=e=>e?(0,h.WU)(e.toDate(),"dd MMM yyyy, HH:mm",{locale:Q.el}):"Άγνωστη ημερομηνία";function eW(e){var t;let{stage:s,onPhotoUpload:a}=e,[n,i]=(0,r.useState)(null),[d,c]=(0,r.useState)(!1),x=async()=>{if(!n)return;c(!0),await a(n),c(!1),i(null);let e=document.getElementById("photo-upload-".concat(s.id));e&&(e.value="")};return(0,l.jsxs)(u.Zb,{className:"mt-4",children:[(0,l.jsxs)(u.Ol,{className:"flex flex-row items-center justify-between",children:[(0,l.jsxs)(u.ll,{className:"text-base",children:["Φωτογραφίες Προόδου (",(null===(t=s.photos)||void 0===t?void 0:t.length)||0,")"]}),(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)(Y.I,{id:"photo-upload-".concat(s.id),type:"file",multiple:!0,accept:"image/*",className:"max-w-xs text-xs h-9",onChange:e=>{i(e.target.files)}}),(0,l.jsxs)(o.z,{size:"sm",onClick:x,disabled:!n||d,children:[(0,l.jsx)(eD.Z,{className:"mr-2"}),d?"Ανέβασμα...":"Ανέβασμα"]})]})]}),(0,l.jsx)(u.aY,{children:s.photos&&s.photos.length>0?(0,l.jsxs)(eC,{opts:{align:"start",loop:!0},className:"w-full",children:[(0,l.jsx)(eS,{children:s.photos.map((e,t)=>(0,l.jsx)(eI,{className:"md:basis-1/2 lg:basis-1/3",children:(0,l.jsx)("div",{className:"p-1",children:(0,l.jsxs)(u.Zb,{children:[(0,l.jsxs)(G.Vq,{children:[(0,l.jsx)(G.hg,{asChild:!0,children:(0,l.jsxs)(u.aY,{className:"flex flex-col aspect-square items-center justify-center p-0 rounded-lg overflow-hidden group relative cursor-pointer",children:[(0,l.jsx)(m.default,{src:e.url,alt:"Progress photo ".concat(t+1),fill:!0,sizes:"(max-width: 768px) 100vw, (max-width: 1200px) 50vw, 33vw",className:"object-contain w-full h-full"}),(0,l.jsx)("div",{className:"absolute inset-0 bg-black/20 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center",children:(0,l.jsx)(eZ.Z,{className:"h-10 w-10 text-white"})})]})}),(0,l.jsx)(G.cZ,{className:"max-w-4xl h-[90vh] p-2 bg-transparent border-none flex items-center justify-center",children:(0,l.jsx)("div",{className:"relative w-full h-full",children:(0,l.jsx)(m.default,{src:e.url,alt:"Progress photo ".concat(t+1),fill:!0,sizes:"100vw",className:"object-contain"})})})]}),(0,l.jsxs)("div",{className:"text-xs text-muted-foreground p-2 text-center",children:[(0,l.jsx)("p",{children:eE(e.uploadedAt)}),(0,l.jsxs)("p",{children:["από ",e.uploadedBy]})]})]})})},t))}),(0,l.jsx)(eU,{}),(0,l.jsx)(ez,{})]}):(0,l.jsxs)("div",{className:"flex flex-col items-center justify-center text-center text-muted-foreground h-24",children:[(0,l.jsx)(eJ.Z,{className:"h-8 w-8"}),(0,l.jsx)("p",{className:"mt-2 text-sm",children:"Δεν υπάρχουν φωτογραφίες για αυτό το στάδιο."})]})})]})}var eL=s(80420),eT=s(82625);function eA(e){let{comments:t}=e;return t&&0!==t.length?(0,l.jsx)("div",{className:"space-y-4",children:t.map(e=>{var t;return(0,l.jsxs)("div",{className:"flex items-start gap-3",children:[(0,l.jsx)(eL.qE,{className:"h-8 w-8",children:(0,l.jsx)(eL.Q5,{children:(t=e.authorEmail)?t.substring(0,2).toUpperCase():"??"})}),(0,l.jsxs)("div",{className:"flex-1 rounded-md bg-muted/50 p-3",children:[(0,l.jsxs)("div",{className:"flex items-baseline justify-between",children:[(0,l.jsx)("p",{className:"font-semibold text-sm",children:e.authorEmail}),(0,l.jsx)("time",{className:"text-xs text-muted-foreground",children:(0,eT.Q)(e.createdAt.toDate(),{addSuffix:!0,locale:Q.el})})]}),(0,l.jsx)("p",{className:"text-sm mt-1 whitespace-pre-wrap",children:e.text})]})]},e.id)})}):(0,l.jsxs)("div",{className:"text-center text-muted-foreground py-4 text-sm",children:[(0,l.jsx)(eh.Z,{className:"mx-auto h-6 w-6"}),(0,l.jsx)("p",{className:"mt-2",children:"Δεν υπάρχουν σχόλια ακόμα."})]})}function eP(e){let{onSubmit:t}=e,{user:s}=(0,U.a)(),[a,n]=(0,r.useState)(""),i=()=>{a.trim()&&s&&(t(a),n(""))};return(0,l.jsxs)(u.eW,{className:"flex gap-2",children:[(0,l.jsx)(B.g,{placeholder:"Προσθήκη σχολίου...",className:"flex-1",value:a,onChange:e=>n(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),i())}}),(0,l.jsxs)(o.z,{size:"sm",onClick:i,disabled:!a.trim(),children:[(0,l.jsx)(eh.Z,{className:"mr-2"}),"Υποβολή"]})]})}let eR=e=>{let{icon:t,label:s,children:a}=e;return(0,l.jsxs)("div",{className:"flex items-start gap-2 text-sm",children:[r.createElement(t,{className:"h-4 w-4 mt-0.5 text-muted-foreground flex-shrink-0"}),(0,l.jsxs)("span",{className:"font-semibold",children:[s,":"]}),(0,l.jsx)("span",{className:"text-muted-foreground break-words",children:a})]})};function e_(e){var t,s;let{stage:r,companies:a,onChecklistItemToggle:n,onAddChecklistItem:i,onAddWorkSubstage:d,onEditWorkStage:c,onDeleteWorkStage:u,onPhotoUpload:x,onInspectionNotesChange:m,onCommentSubmit:h,isSubstage:j}=e,p=_(r.checklist);return(0,l.jsxs)("div",{className:"space-y-4 py-4",children:["Ολοκληρώθηκε"!==r.status&&100!==p&&(0,l.jsxs)(eg,{variant:"destructive",children:[(0,l.jsx)(es.Z,{className:"h-4 w-4"}),(0,l.jsx)(ev,{children:"Εκκρεμείς Επιθεωρήσεις"}),(0,l.jsx)(eN,{children:"Το στάδιο δεν μπορεί να ολοκληρωθεί. Παρακαλώ ολοκληρώστε όλα τα αντικείμενα του checklist επιθεώρησης."})]}),(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-x-4 gap-y-2",children:[(0,l.jsx)(eR,{icon:el.Z,label:"Ανάθεση",children:P(r.assignedTo,a)}),(0,l.jsx)(eR,{icon:M.Z,label:"Έναρξη",children:T(r.startDate)}),(0,l.jsx)(eR,{icon:er.Z,label:"Λήξη",children:T(r.endDate)}),(0,l.jsx)(eR,{icon:ea.Z,label:"Προθεσμία",children:T(r.deadline)}),(0,l.jsx)(eR,{icon:en.Z,label:"Budget",children:R(r.budgetedCost)}),(0,l.jsx)(eR,{icon:en.Z,label:"Actual",children:R(r.actualCost)}),(0,l.jsx)(eR,{icon:ei.Z,label:"Σχετίζεται με",children:(null===(t=r.relatedEntityIds)||void 0===t?void 0:t.join(", "))||"-"}),(0,l.jsx)(eR,{icon:ed.Z,label:"Εξαρτάται από",children:(null===(s=r.dependsOn)||void 0===s?void 0:s.join(", "))||"-"}),r.notes&&(0,l.jsx)("div",{className:"col-span-full",children:(0,l.jsx)(eR,{icon:eo.Z,label:"Σημειώσεις",children:r.notes})})]}),(0,l.jsx)(eW,{stage:r,onPhotoUpload:e=>x(r,e,j)}),(0,l.jsx)(ep,{stage:r,onToggle:(e,t)=>n(r,e,t,j),onAdd:e=>i(r,e,j),onNotesChange:(e,t)=>m(r,e,t,j)}),r.workSubstages&&r.workSubstages.length>0&&(0,l.jsxs)("div",{className:"ml-4 mt-2 border-l-2 pl-4",children:[(0,l.jsx)("h4",{className:"font-semibold mb-2",children:"Υποστάδια:"}),r.workSubstages.map(e=>(0,l.jsxs)("div",{className:"mb-4 p-2 rounded-md hover:bg-muted/30",children:[(0,l.jsx)(et,{stage:{...e,workSubstages:[]},isSubstage:!0}),(0,l.jsx)(e_,{stage:{...e,workSubstages:[]},companies:a,onChecklistItemToggle:n,onAddChecklistItem:i,onEditWorkStage:c,onDeleteWorkStage:u,onPhotoUpload:x,onInspectionNotesChange:m,onCommentSubmit:h,isSubstage:!0})]},e.id))]}),!j&&(0,l.jsxs)("div",{className:"flex items-center gap-2 mt-4 pt-4 border-t",children:[(0,l.jsxs)(o.z,{variant:"outline",size:"sm",onClick:()=>null==d?void 0:d(r.id),children:[(0,l.jsx)(ec.Z,{className:"mr-2"}),"Νέο Υποστάδιο"]}),(0,l.jsxs)(o.z,{variant:"outline",size:"sm",onClick:()=>c(r),children:[(0,l.jsx)(y.Z,{className:"mr-2"}),"Επεξεργασία Σταδίου"]}),(0,l.jsxs)(v.aR,{children:[(0,l.jsx)(v.vW,{asChild:!0,children:(0,l.jsxs)(o.z,{variant:"destructive_outline",size:"sm",children:[(0,l.jsx)(k.Z,{className:"mr-2"}),"Διαγραφή Σταδίου"]})}),(0,l.jsxs)(v._T,{children:[(0,l.jsxs)(v.fY,{children:[(0,l.jsx)(v.f$,{children:"Είστε σίγουροι;"}),(0,l.jsxs)(v.yT,{children:['Αυτή η ενέργεια θα διαγράψει οριστικά το στάδιο "',r.name,'" και όλα τα υποστάδια του.']})]}),(0,l.jsxs)(v.xo,{children:[(0,l.jsx)(v.le,{children:"Ακύρωση"}),(0,l.jsx)(v.OL,{onClick:()=>u(r),className:"bg-destructive hover:bg-destructive/90",children:"Διαγραφή"})]})]})]})]}),(0,l.jsxs)("div",{className:"mt-6 border-t pt-4",children:[(0,l.jsx)(eA,{comments:r.comments||[]}),(0,l.jsx)(eP,{onSubmit:e=>h(r,e,j)})]})]})}function eO(e){let{workStages:t,companies:s,onAddWorkSubstage:r,onEditWorkStage:a,onDeleteWorkStage:n,onChecklistItemToggle:i,onAddChecklistItem:d,onInspectionNotesChange:o,onPhotoUpload:c,onCommentSubmit:u}=e;return(0,l.jsx)(H.UQ,{type:"multiple",className:"w-full",children:t.map(e=>(0,l.jsxs)(H.Qd,{value:e.id,children:[(0,l.jsx)(H.o4,{className:"hover:bg-muted/50 px-4 rounded-md",children:(0,l.jsx)(et,{stage:e,isSubstage:!1})}),(0,l.jsx)(H.vF,{className:"px-4 pt-0",children:(0,l.jsx)(e_,{stage:e,companies:s,onChecklistItemToggle:i,onAddChecklistItem:d,onAddWorkSubstage:r,onEditWorkStage:a,onDeleteWorkStage:n,onPhotoUpload:c,onInspectionNotesChange:o,onCommentSubmit:u,isSubstage:!1})})]},e.id))})}var eG=s(28099);function eX(e){let{onAddNewStage:t}=e;return(0,l.jsxs)("div",{className:"text-center py-12",children:[(0,l.jsx)(eG.Z,{className:"mx-auto h-12 w-12 text-muted-foreground"}),(0,l.jsx)("h3",{className:"mt-4 text-lg font-medium",children:"Δεν υπάρχουν ακόμα στάδια εργασίας"}),(0,l.jsx)("p",{className:"mt-2 text-sm text-muted-foreground",children:"Ξεκίνα προσθέτοντας το πρώτο στάδιο για να οργανώσεις το έργο σου."}),(0,l.jsx)("div",{className:"mt-6",children:(0,l.jsx)(o.z,{onClick:t,children:"Προσθήκη Πρώτου Σταδίου"})})]})}function eY(e){let{project:t}=e,{isEditor:s}=(0,U.a)(),{companies:a,isLoading:c}=(0,Z.JE)(),{workStages:x,isLoadingWorkStages:m,isSubmitting:h,form:j,editingWorkStage:p,handleEditWorkStage:f,handleAddWorkSubstage:g,handleDeleteWorkStage:v,onSubmitWorkStage:y,handleChecklistItemToggle:k,handleAddChecklistItem:I,handleInspectionNotesChange:z,setEditingWorkStage:E,handlePhotoUpload:A,handleCommentSubmit:P,handleExport:R}=function(e,t){let{workStages:s,setWorkStages:l,isLoadingWorkStages:a}=function(e){let[t,s]=(0,r.useState)([]),[l,a]=(0,r.useState)(!0);return(0,r.useEffect)(()=>{if(!e){a(!1);return}let t=(0,n.IO)((0,n.hJ)(i.db,"projects",e,"workStages"),(0,n.Xo)("createdAt","asc")),l=(0,n.cf)(t,async t=>{let l=t.docs.map(async t=>{let s=t.data(),l={id:t.id,name:s.name||"",status:s.status||"Εκκρεμεί",...s,workSubstages:[]},r=(0,n.IO)((0,n.hJ)(i.db,"projects",e,"workStages",l.id,"workSubstages"),(0,n.Xo)("createdAt","asc")),a=await (0,n.PL)(r);return l.workSubstages=a.docs.map(e=>({id:e.id,...e.data()})),l});s(await Promise.all(l)),a(!1)},e=>{console.error("Error fetching work stages:",e),a(!1)});return()=>l()},[e]),{workStages:t,setWorkStages:s,isLoadingWorkStages:l}}(e),{form:d,isSubmitting:o,editingWorkStage:c,setEditingWorkStage:u,handleEditWorkStage:x,handleAddWorkSubstage:m,onSubmitWorkStage:h}=function(e){let[t,s]=(0,r.useState)(!1),[l,a]=(0,r.useState)(null),{toast:d}=(0,C.pm)(),o=(0,N.cI)({resolver:(0,b.F)(W),defaultValues:{id:void 0,name:"",status:"Εκκρεμεί",assignedTo:"",notes:"",startDate:null,endDate:null,deadline:null,documents:"",description:"",relatedEntityIds:"",dependsOn:"",budgetedCost:"",actualCost:""}}),c=async t=>{if(!e)return;s(!0);let r=(0,n.qs)(i.db),c=Object.fromEntries(Object.entries({name:t.name,description:t.description||"",status:t.status,assignedTo:t.assignedTo?[t.assignedTo]:[],relatedEntityIds:t.relatedEntityIds?t.relatedEntityIds.split(",").map(e=>e.trim()).filter(Boolean):[],dependsOn:t.dependsOn?t.dependsOn.split(",").map(e=>e.trim()).filter(Boolean):[],notes:t.notes||"",startDate:t.startDate,endDate:t.endDate,deadline:t.deadline,documents:t.documents?t.documents.split("\\n").map(e=>e.trim()).filter(Boolean):[],budgetedCost:t.budgetedCost?parseFloat(t.budgetedCost):void 0,actualCost:t.actualCost?parseFloat(t.actualCost):void 0}).filter(e=>{let[t,s]=e;return null!=s&&""!==s}));if(c.startDate&&(c.startDate=n.EK.fromDate(c.startDate)),c.endDate&&(c.endDate=n.EK.fromDate(c.endDate)),c.deadline&&(c.deadline=n.EK.fromDate(c.deadline)),c.documents&&Array.isArray(c.documents)){let e=c.documents.map(e=>({task:e,completed:!1})),t=(l&&"checklist"in l&&l.checklist||[]).filter(e=>!e.task.startsWith("Doc:"));c.checklist=[...t,...e]}try{var u,x;let t=l&&"parentId"in l;if(l&&"id"in l){let t=l.parentId,s=l.id,a=l.topLevelId;if(!a)throw Error("topLevelId is missing for editing.");let o=t?(0,n.JU)(i.db,"workSubstages",a):(0,n.JU)(i.db,"workStages",a),x=t?(0,n.JU)(i.db,"projects",e,"workStages",t,"workSubstages",s):(0,n.JU)(i.db,"projects",e,"workStages",s);r.update(o,{...c,assignedToId:(null===(u=c.assignedTo)||void 0===u?void 0:u[0])||null}),r.update(x,c),d({title:"Επιτυχία",description:"Το Στάδιο Εργασίας ενημερώθηκε."})}else{let s=t?l.parentId:null;if(t&&!s)throw Error("Parent ID is missing for substage creation.");let a=s?(0,n.JU)((0,n.hJ)(i.db,"workSubstages")):(0,n.JU)((0,n.hJ)(i.db,"workStages")),o=(0,n.JU)((0,n.hJ)(i.db,"projects",e,s?"workStages/".concat(s,"/workSubstages"):"workStages"));r.set(o,{...c,createdAt:(0,n.Bt)(),inspections:[],photos:[],comments:[],topLevelId:a.id}),r.set(a,{...c,projectId:e,parentStageId:s,assignedToId:(null===(x=c.assignedTo)||void 0===x?void 0:x[0])||null,createdAt:(0,n.Bt)(),originalId:o.id}),d({title:"Επιτυχία",description:"Το ".concat(t?"υποστάδιο":"στάδιο"," προστέθηκε.")})}await r.commit(),a(null),o.reset()}catch(e){console.error("Error submitting work stage/substage:",e),d({variant:"destructive",title:"Σφάλμα",description:"Η υποβολή απέτυχε."})}finally{s(!1)}};return{form:o,isSubmitting:t,editingWorkStage:l,setEditingWorkStage:a,handleEditWorkStage:(e,t)=>{var s,l,r,n,i,d,c,u,x;a(t?{...e,parentId:t}:e),o.reset({...e,description:e.description||"",notes:e.notes||"",assignedTo:(null===(s=e.assignedTo)||void 0===s?void 0:s[0])||"",documents:(null===(l=e.documents)||void 0===l?void 0:l.join("\\n"))||"",relatedEntityIds:(null===(r=e.relatedEntityIds)||void 0===r?void 0:r.join(", "))||"",dependsOn:(null===(n=e.dependsOn)||void 0===n?void 0:n.join(", "))||"",startDate:(null===(i=e.startDate)||void 0===i?void 0:i.toDate())||null,endDate:(null===(d=e.endDate)||void 0===d?void 0:d.toDate())||null,deadline:(null===(c=e.deadline)||void 0===c?void 0:c.toDate())||null,budgetedCost:(null===(u=e.budgetedCost)||void 0===u?void 0:u.toString())||"",actualCost:(null===(x=e.actualCost)||void 0===x?void 0:x.toString())||""})},handleAddWorkSubstage:e=>{a({parentId:e}),o.reset({status:"Εκκρεμεί",name:"",description:"",notes:"",documents:"",assignedTo:""})},onSubmitWorkStage:c}}(e),{handleDeleteWorkStage:j,handleExport:p}=function(e,t,s){let{toast:l}=(0,C.pm)();return{handleDeleteWorkStage:async(t,s)=>{if(!e)return;let r=(0,n.qs)(i.db);try{if(s){let l=(0,n.JU)(i.db,"projects",e,"workStages",s,"workSubstages",t.id),a=(0,n.JU)(i.db,"workSubstages",t.topLevelId);r.delete(l),r.delete(a)}else{let s=(0,n.JU)(i.db,"projects",e,"workStages",t.id),l=(0,n.JU)(i.db,"workStages",t.topLevelId);for(let e of(r.delete(s),r.delete(l),(await (0,n.PL)((0,n.hJ)(s,"workSubstages"))).docs)){r.delete(e.ref);let t=e.data().topLevelId;t&&r.delete((0,n.JU)(i.db,"workSubstages",t))}}await r.commit(),l({title:"Επιτυχία",description:"Το Στάδιο Εργασίας διαγράφηκε."}),await (0,S.a)(s?"DELETE_WORK_SUBSTAGE":"DELETE_WORK_STAGE",{entityId:t.id,entityType:s?"workSubstage":"workStage",details:{name:t.name,parentId:s},projectId:e})}catch(e){console.error("Error deleting work stage/substage:",e),l({variant:"destructive",title:"Σφάλμα",description:"Η διαγραφή απέτυχε."})}},handleExport:(0,r.useCallback)(()=>{let e=s.flatMap(e=>{let t={level:"Στάδιο Εργασίας",name:e.name,status:e.status,startDate:T(e.startDate),endDate:T(e.endDate),deadline:T(e.deadline),budgetedCost:e.budgetedCost,actualCost:e.actualCost};return 0===e.workSubstages.length?[t]:[t,...e.workSubstages.map(t=>({level:"Υποστάδιο Εργασίας",name:"".concat(e.name," > ").concat(t.name),status:t.status,startDate:T(t.startDate),endDate:T(t.endDate),deadline:T(t.deadline),budgetedCost:t.budgetedCost,actualCost:t.actualCost}))]}),l="report-".concat(t.toLowerCase().replace(/\s+/g,"-"));(0,L.Rk)(e,l)},[s,t])}}(e,t,s),{handleChecklistItemToggle:f,handleAddChecklistItem:g,handleInspectionNotesChange:v}=function(e,t,s){let{user:l}=(0,U.a)(),{toast:r}=(0,C.pm)();return{handleChecklistItemToggle:async(a,d,o,c)=>{var u;if(!e||!l)return;let x=c?null===(u=t.find(e=>e.workSubstages.some(e=>e.id===a.id)))||void 0===u?void 0:u.id:void 0;if(c&&!x)return;let m=[...t];s(m.map(e=>{if(!c&&e.id===a.id){let t=[...e.checklist||[]];return t[d]={...t[d],completed:o},{...e,checklist:t}}return c&&e.id===x?{...e,workSubstages:e.workSubstages.map(e=>{if(e.id===a.id){let t=[...e.checklist||[]];return t[d]={...t[d],completed:o},{...e,checklist:t}}return e})}:e}));try{let t=x?(0,n.JU)(i.db,"projects",e,"workStages",x,"workSubstages",a.id):(0,n.JU)(i.db,"projects",e,"workStages",a.id),s=[...a.checklist||[]],r={...s[d],completed:o,completionDate:o?n.EK.now():void 0,completedBy:o&&l.email||void 0};s[d]=r;let c=(0,n.qs)(i.db);c.update(t,{checklist:s});let u=a.topLevelId;if(u){let e=x?(0,n.JU)(i.db,"workSubstages",u):(0,n.JU)(i.db,"workStages",u);c.update(e,{checklist:s})}await c.commit()}catch(e){console.error("Failed to update checklist item:",e),s(m),r({variant:"destructive",title:"Σφάλμα",description:"Η αλλαγή απέτυχε. Επαναφορά."})}},handleAddChecklistItem:async(s,l,r)=>{var a;if(!e)return;let d=r?null===(a=t.find(e=>e.workSubstages.some(e=>e.id===s.id)))||void 0===a?void 0:a.id:void 0;if(r&&!d)return;let o=d?(0,n.JU)(i.db,"projects",e,"workStages",d,"workSubstages",s.id):(0,n.JU)(i.db,"projects",e,"workStages",s.id),c={task:l,completed:!1},u=(0,n.qs)(i.db);u.update(o,{checklist:(0,n.vr)(c)});let x=s.topLevelId;if(x){let e=d?(0,n.JU)(i.db,"workSubstages",x):(0,n.JU)(i.db,"workStages",x);u.update(e,{checklist:(0,n.vr)(c)})}await u.commit()},handleInspectionNotesChange:async(s,l,a,d)=>{var o;if(!e)return;let c=d?null===(o=t.find(e=>e.workSubstages.some(e=>e.id===s.id)))||void 0===o?void 0:o.id:void 0;if(d&&!c)return;let u=c?(0,n.JU)(i.db,"projects",e,"workStages",c,"workSubstages",s.id):(0,n.JU)(i.db,"projects",e,"workStages",s.id),x=[...s.checklist||[]];x[l]&&(x[l].inspectionNotes=a);let m=(0,n.qs)(i.db);m.update(u,{checklist:x});let h=s.topLevelId;if(h){let e=c?(0,n.JU)(i.db,"workSubstages",h):(0,n.JU)(i.db,"workStages",h);m.update(e,{checklist:x})}await m.commit(),r({title:"Οι παρατηρήσεις αποθηκεύτηκαν."})}}}(e,s,l),{handlePhotoUpload:w,handleCommentSubmit:y}=function(e,t){let{user:s}=(0,U.a)(),{toast:l}=(0,C.pm)();return{handlePhotoUpload:async(r,a,d)=>{var o;if(!a.length||!s||!e)return;let c=d?null===(o=t.find(e=>e.workSubstages.some(e=>e.id===r.id)))||void 0===o?void 0:o.id:void 0;if(d&&!c)return;let u=c?(0,n.JU)(i.db,"projects",e,"workStages",c,"workSubstages",r.id):(0,n.JU)(i.db,"projects",e,"workStages",r.id);l({title:"Ανέβασμα...",description:"Ανέβασμα ".concat(a.length," φωτογραφιών...")});try{let t=Array.from(a).map(async t=>{let l=(0,J.iH)(i.tO,"work_stages_photos/".concat(e,"/").concat(r.id,"/").concat(t.name));return await (0,J.KV)(l,t),{url:await (0,J.Jt)(l),uploadedAt:n.EK.now(),uploadedBy:s.email||s.uid,name:t.name}}),d=await Promise.all(t),o=(0,n.qs)(i.db);o.update(u,{photos:(0,n.vr)(...d)});let x=r.topLevelId;if(x){let e=c?(0,n.JU)(i.db,"workSubstages",x):(0,n.JU)(i.db,"workStages",x);o.update(e,{photos:(0,n.vr)(...d)})}await o.commit(),l({title:"Επιτυχία",description:"Οι φωτογραφίες ανέβηκαν επιτυχώς."})}catch(e){console.error("Photo upload failed:",e),l({variant:"destructive",title:"Σφάλμα",description:"Το ανέβασμα των φωτογραφιών απέτυχε."})}},handleCommentSubmit:async(l,r,a)=>{var d;if(!e||!(null==s?void 0:s.email))return;let o=a?null===(d=t.find(e=>e.workSubstages.some(e=>e.id===l.id)))||void 0===d?void 0:d.id:void 0;if(a&&!o)return;let c=o?(0,n.JU)(i.db,"projects",e,"workStages",o,"workSubstages",l.id):(0,n.JU)(i.db,"projects",e,"workStages",l.id),u={id:(0,n.JU)((0,n.hJ)(i.db,"dummy")).id,text:r,authorId:s.uid,authorEmail:s.email,createdAt:n.EK.now(),type:"client"===s.photoURL?"client":"internal"},x=(0,n.qs)(i.db);x.update(c,{comments:(0,n.vr)(u)});let m=l.topLevelId;if(m){let e=o?(0,n.JU)(i.db,"workSubstages",m):(0,n.JU)(i.db,"workStages",m);x.update(e,{comments:(0,n.vr)(u)})}await x.commit()}}}(e,s);return{workStages:s,isLoadingWorkStages:a,isSubmitting:o,form:d,editingWorkStage:c,setEditingWorkStage:u,handleEditWorkStage:x,handleAddWorkSubstage:m,handleDeleteWorkStage:j,onSubmitWorkStage:h,handleChecklistItemToggle:f,handleAddChecklistItem:g,handleInspectionNotesChange:v,handlePhotoUpload:w,handleCommentSubmit:y,handleExport:p}}(t.id,t.title),[_,O]=(0,r.useState)(!1),G=()=>O(!0),X=()=>{E(null),j.reset({status:"Εκκρεμεί",name:"",description:"",notes:"",documents:"",assignedTo:""}),G()};return(0,l.jsxs)(u.Zb,{children:[(0,l.jsx)(u.Ol,{children:(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsx)(u.ll,{children:"Στάδια Εργασίας"}),(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsxs)(o.z,{size:"sm",variant:"outline",onClick:R,disabled:m||0===x.length,children:[(0,l.jsx)(D.Z,{className:"mr-2"}),"Εξαγωγή Αναφοράς"]}),s&&(0,l.jsxs)(o.z,{size:"sm",onClick:X,children:[(0,l.jsx)(w.Z,{className:"mr-2"}),"Νέο Στάδιο Εργασίας"]})]})]})}),(0,l.jsx)(u.aY,{children:m?(0,l.jsx)("div",{className:"flex justify-center items-center h-24",children:(0,l.jsx)(d.Z,{className:"h-8 w-8 animate-spin text-muted-foreground"})}):x.length>0?(0,l.jsx)(eO,{workStages:x,companies:a,onAddWorkSubstage:e=>{g(e),G()},onEditWorkStage:(e,t)=>{f(e,t),G()},onDeleteWorkStage:v,onChecklistItemToggle:k,onAddChecklistItem:I,onInspectionNotesChange:z,onPhotoUpload:A,onCommentSubmit:P}):(0,l.jsx)(eX,{onAddNewStage:X})}),s&&(0,l.jsx)($,{open:_,onOpenChange:()=>{O(!1),E(null),j.reset()},form:j,onSubmit:j.handleSubmit(y),isSubmitting:h,editingWorkStage:p,companies:a,isLoadingCompanies:c})]})}var eB=s(54817),eM=s(65118);async function eV(e){if(!e)return[];let t=(0,n.hJ)(i.db,"auditLogs"),s=(0,n.IO)(t,(0,n.ar)("projectId","==",e),(0,n.Xo)("timestamp","desc"));return new Promise((e,t)=>{(0,n.cf)(s,t=>{e(t.docs.map(e=>({id:e.id,...e.data()})))},e=>{console.error("Failed to fetch project audit logs:",e),t(e)})})}function eq(e){let{projectId:t}=e,[s,a]=(0,r.useState)(""),{toast:n}=(0,C.pm)(),{data:i=[],isLoading:o,isError:c}=(0,eM.a)({queryKey:["projectAuditLogs",t],queryFn:()=>eV(t),enabled:!!t}),m=e=>e?e.toDate?(0,h.WU)(e.toDate(),"dd/MM/yyyy, HH:mm:ss",{locale:Q.el}):"Άγνωστη ημερομηνία":"N/A",j=(0,r.useMemo)(()=>i?i.filter(e=>{let t=s.toLowerCase();return e.action.toLowerCase().includes(t)||e.entityType.toLowerCase().includes(t)||e.userEmail.toLowerCase().includes(t)||e.entityId.toLowerCase().includes(t)}):[],[i,s]),p=e=>e.startsWith("CREATE")||e.startsWith("DUPLICATE")?"default":e.startsWith("UPDATE")||e.startsWith("UPLOAD")?"secondary":e.startsWith("DELETE")?"destructive":"outline";return(0,l.jsxs)(u.Zb,{children:[(0,l.jsxs)(u.Ol,{children:[(0,l.jsx)(u.ll,{children:"Ιστορικό Ενεργειών Έργου"}),(0,l.jsx)(u.SZ,{children:"Καταγραφή όλων των αλλαγών που έχουν γίνει σε αυτό το έργο."})]}),(0,l.jsxs)(u.aY,{children:[(0,l.jsxs)("div",{className:"relative mb-4",children:[(0,l.jsx)(eB.Z,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-muted-foreground"}),(0,l.jsx)(Y.I,{type:"search",placeholder:"Αναζήτηση στο ιστορικό του έργου...",className:"pl-10 w-full md:w-1/3",value:s,onChange:e=>a(e.target.value)})]}),o?(0,l.jsx)("div",{className:"flex justify-center items-center h-40",children:(0,l.jsx)(d.Z,{className:"h-8 w-8 animate-spin text-muted-foreground"})}):c?(0,l.jsx)("p",{className:"text-center text-destructive py-8",children:"Σφάλμα κατά τη φόρτωση του ιστορικού."}):j.length>0?(0,l.jsxs)(g.iA,{children:[(0,l.jsx)(g.xD,{children:(0,l.jsxs)(g.SC,{children:[(0,l.jsx)(g.ss,{children:"Χρονοσφραγίδα"}),(0,l.jsx)(g.ss,{children:"Χρήστης"}),(0,l.jsx)(g.ss,{children:"Ενέργεια"}),(0,l.jsx)(g.ss,{children:"Τύπος Οντότητας"}),(0,l.jsx)(g.ss,{children:"ID Οντότητας"})]})}),(0,l.jsx)(g.RM,{children:j.map(e=>(0,l.jsxs)(g.SC,{children:[(0,l.jsx)(g.pj,{className:"text-muted-foreground whitespace-nowrap",children:m(e.timestamp)}),(0,l.jsx)(g.pj,{className:"font-medium",children:e.userEmail}),(0,l.jsx)(g.pj,{children:(0,l.jsx)(x.C,{variant:p(e.action),children:e.action})}),(0,l.jsx)(g.pj,{className:"text-muted-foreground",children:e.entityType}),(0,l.jsx)(g.pj,{className:"text-muted-foreground font-mono text-xs",children:e.entityId})]},e.id))})]}):(0,l.jsx)("p",{className:"text-center text-muted-foreground py-8",children:s?"Δεν βρέθηκαν εγγραφές που να ταιριάζουν με την αναζήτηση.":"Δεν υπάρχουν εγγραφές στο ιστορικό για αυτό το έργο."})]})]})}function eK(e){let{project:t}=e;return(0,l.jsxs)(u.Zb,{children:[(0,l.jsxs)(u.Ol,{children:[(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsx)(u.ll,{children:"Συσκέψεις Έργου"}),(0,l.jsxs)(o.z,{size:"sm",onClick:()=>alert("New Meeting form will open!"),children:[(0,l.jsx)(w.Z,{className:"mr-2"}),"Νέα Συνάντηση"]})]}),(0,l.jsx)(u.SZ,{children:"Καταγραφή και παρακολούθηση όλων των συναντήσεων που αφορούν το έργο."})]}),(0,l.jsx)(u.aY,{children:(0,l.jsxs)("div",{className:"text-center py-12",children:[(0,l.jsx)("h3",{className:"mt-4 text-lg font-medium",children:"Δεν έχουν καταγραφεί συναντήσεις"}),(0,l.jsx)("p",{className:"mt-2 text-sm text-muted-foreground",children:"Καταγράψτε την πρώτη συνάντηση για να ξεκινήσετε."}),(0,l.jsx)("div",{className:"mt-6",children:(0,l.jsx)(o.z,{onClick:()=>alert("New Meeting form will open!"),children:"Καταγραφή Πρώτης Συνάντησης"})})]})})]})}function eF(e){let{project:t}=e;return(0,l.jsxs)(u.Zb,{children:[(0,l.jsxs)(u.Ol,{children:[(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsx)(u.ll,{children:"Συμβόλαια & Συμφωνητικά Έργου"}),(0,l.jsxs)(o.z,{size:"sm",onClick:()=>alert("New Contract form will open!"),children:[(0,l.jsx)(w.Z,{className:"mr-2"}),"Νέο Συμβόλαιο"]})]}),(0,l.jsx)(u.SZ,{children:"Διαχείριση όλων των συμβατικών εγγράφων που σχετίζονται με το έργο."})]}),(0,l.jsx)(u.aY,{children:(0,l.jsxs)("div",{className:"text-center py-12",children:[(0,l.jsx)("h3",{className:"mt-4 text-lg font-medium",children:"Δεν έχουν καταγραφεί συμβόλαια"}),(0,l.jsx)("p",{className:"mt-2 text-sm text-muted-foreground",children:"Καταχωρήστε το πρώτο συμβόλαιο για να ξεκινήσετε."}),(0,l.jsx)("div",{className:"mt-6",children:(0,l.jsx)(o.z,{onClick:()=>alert("New Contract form will open!"),children:"Καταχώρηση Πρώτου Συμβολαίου"})})]})})]})}function eQ(e){let{project:t}=e;return(0,l.jsxs)(u.Zb,{children:[(0,l.jsxs)(u.Ol,{children:[(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsx)(u.ll,{children:"Παραγγελίες & Παραλαβές Υλικών"}),(0,l.jsxs)(o.z,{size:"sm",onClick:()=>alert("New Order form will open!"),children:[(0,l.jsx)(w.Z,{className:"mr-2"}),"Νέα Παραγγελία"]})]}),(0,l.jsx)(u.SZ,{children:"Διαχείριση όλων των παραγγελιών και παραλαβών υλικών που σχετίζονται με το έργο."})]}),(0,l.jsx)(u.aY,{children:(0,l.jsxs)("div",{className:"text-center py-12",children:[(0,l.jsx)("h3",{className:"mt-4 text-lg font-medium",children:"Δεν έχουν καταγραφεί παραγγελίες"}),(0,l.jsx)("p",{className:"mt-2 text-sm text-muted-foreground",children:"Καταχωρήστε την πρώτη παραγγελία για να ξεκινήσετε."}),(0,l.jsx)("div",{className:"mt-6",children:(0,l.jsx)(o.z,{onClick:()=>alert("New Order form will open!"),children:"Καταχώρηση Πρώτης Παραγγελίας"})})]})})]})}function e$(){let e=(0,a.useParams)(),t=(0,a.useRouter)(),s=(0,a.useSearchParams)(),u=e.id,x=s.get("view")||"work-stages",[m,h]=(0,r.useState)(null),[j,g]=(0,r.useState)(!0);return((0,r.useEffect)(()=>{if(!u)return;let e=(0,n.JU)(i.db,"projects",u),t=(0,n.cf)(e,e=>{e.exists()?h({id:e.id,...e.data()}):console.error("Project not found!"),g(!1)});return()=>t()},[u]),j)?(0,l.jsx)("div",{className:"flex h-full w-full items-center justify-center",children:(0,l.jsx)(d.Z,{className:"h-16 w-16 animate-spin text-muted-foreground"})}):m?(0,l.jsxs)("div",{className:"flex flex-col gap-8",children:[(0,l.jsx)("div",{className:"flex items-center justify-between",children:(0,l.jsxs)(o.z,{variant:"outline",size:"sm",onClick:()=>t.push("/projects"),className:"w-fit",children:[(0,l.jsx)(c.Z,{className:"mr-2 h-4 w-4"}),"Επιστροφή στη Λίστα"]})}),(0,l.jsx)(p,{project:m}),(0,l.jsxs)(f.mQ,{value:x,onValueChange:e=>{t.push("/projects/".concat(u,"?view=").concat(e))},className:"w-full",children:[(0,l.jsxs)(f.dr,{className:"grid w-full grid-cols-6",children:[(0,l.jsx)(f.SP,{value:"work-stages",children:"Στάδια Εργασιών"}),(0,l.jsx)(f.SP,{value:"buildings",children:"Κτίρια"}),(0,l.jsx)(f.SP,{value:"meetings",children:"Συσκέψεις"}),(0,l.jsx)(f.SP,{value:"contracts",children:"Συμβόλαια"}),(0,l.jsx)(f.SP,{value:"materials",children:"Υλικά"}),(0,l.jsx)(f.SP,{value:"activity",children:"Ιστορικό"})]}),(0,l.jsx)(f.nU,{value:"work-stages",className:"mt-4",children:(0,l.jsx)(eY,{project:m})}),(0,l.jsx)(f.nU,{value:"buildings",className:"mt-4",children:(0,l.jsx)(z,{project:m})}),(0,l.jsx)(f.nU,{value:"meetings",className:"mt-4",children:(0,l.jsx)(eK,{project:m})}),(0,l.jsx)(f.nU,{value:"contracts",className:"mt-4",children:(0,l.jsx)(eF,{project:m})}),(0,l.jsx)(f.nU,{value:"materials",className:"mt-4",children:(0,l.jsx)(eQ,{project:m})}),(0,l.jsx)(f.nU,{value:"activity",className:"mt-4",children:(0,l.jsx)(eq,{projectId:m.id})})]})]}):(0,l.jsx)("p",{className:"text-center",children:"Δεν βρέθηκε το έργο."})}},3187:function(e,t,s){"use strict";s.d(t,{$:function(){return x},h:function(){return u}});var l=s(57437),r=s(59917),a=s(54662),n=s(93363),i=s(77209),d=s(4919),o=s(89733),c=s(3274);let u=r.Ry({id:r.Z_().optional(),address:r.Z_().min(1,{message:"Η διεύθυνση είναι υποχρεωτική."}),type:r.Z_().min(1,{message:"Ο τύπος είναι υποχρεωτικός."}),description:r.Z_().optional(),photoUrl:r.Z_().url({message:"Το URL της φωτογραφίας δεν είναι έγκυρο."}).or(r.i0("")),floorsCount:r.oQ.number().int().positive().optional(),constructionYear:r.oQ.number().int().min(1900).max(new Date().getFullYear()+5).optional(),tags:r.Z_().optional(),identifier:r.Z_().min(1,"Ο κωδικός κτιρίου είναι υποχρεωτικός.")});function x(e){let{open:t,onOpenChange:s,form:r,onSubmit:u,isSubmitting:x,editingBuilding:m}=e;return(0,l.jsx)(a.Vq,{open:t,onOpenChange:s,children:(0,l.jsxs)(a.cZ,{className:"sm:max-w-lg",children:[(0,l.jsxs)(a.fK,{children:[(0,l.jsxs)(a.$N,{children:[m?"Επεξεργασία":"Προσθήκη Νέου"," Κτιρίου"]}),(0,l.jsx)(a.Be,{children:"Συμπληρώστε τις πληροφορίες για το κτίριο του έργου."})]}),(0,l.jsx)(n.l0,{...r,children:(0,l.jsxs)("form",{onSubmit:u,className:"grid max-h-[80vh] gap-4 overflow-y-auto py-4 pr-4",children:[(0,l.jsx)(n.Wi,{control:r.control,name:"identifier",render:e=>{let{field:t}=e;return(0,l.jsxs)(n.xJ,{children:[(0,l.jsx)(n.lX,{children:"Κωδικός Κτιρίου"}),(0,l.jsx)(n.NI,{children:(0,l.jsx)(i.I,{placeholder:"π.χ. Α, Β, W1",...t})}),(0,l.jsx)(n.zG,{})]})}}),(0,l.jsx)(n.Wi,{control:r.control,name:"address",render:e=>{let{field:t}=e;return(0,l.jsxs)(n.xJ,{children:[(0,l.jsx)(n.lX,{children:"Διεύθυνση"}),(0,l.jsx)(n.NI,{children:(0,l.jsx)(i.I,{...t})}),(0,l.jsx)(n.zG,{})]})}}),(0,l.jsx)(n.Wi,{control:r.control,name:"type",render:e=>{let{field:t}=e;return(0,l.jsxs)(n.xJ,{children:[(0,l.jsx)(n.lX,{children:"Τύπος"}),(0,l.jsx)(n.NI,{children:(0,l.jsx)(i.I,{...t})}),(0,l.jsx)(n.zG,{})]})}}),(0,l.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,l.jsx)(n.Wi,{control:r.control,name:"floorsCount",render:e=>{let{field:t}=e;return(0,l.jsxs)(n.xJ,{children:[(0,l.jsx)(n.lX,{children:"Αρ. Ορόφων"}),(0,l.jsx)(n.NI,{children:(0,l.jsx)(i.I,{type:"number",...t,onChange:e=>t.onChange(""===e.target.value?void 0:Number(e.target.value))})}),(0,l.jsx)(n.zG,{})]})}}),(0,l.jsx)(n.Wi,{control:r.control,name:"constructionYear",render:e=>{let{field:t}=e;return(0,l.jsxs)(n.xJ,{children:[(0,l.jsx)(n.lX,{children:"Έτος Κατασκευής"}),(0,l.jsx)(n.NI,{children:(0,l.jsx)(i.I,{type:"number",...t,onChange:e=>t.onChange(""===e.target.value?void 0:Number(e.target.value))})}),(0,l.jsx)(n.zG,{})]})}})]}),(0,l.jsx)(n.Wi,{control:r.control,name:"photoUrl",render:e=>{let{field:t}=e;return(0,l.jsxs)(n.xJ,{children:[(0,l.jsx)(n.lX,{children:"URL Φωτογραφίας"}),(0,l.jsx)(n.NI,{children:(0,l.jsx)(i.I,{...t})}),(0,l.jsx)(n.zG,{})]})}}),(0,l.jsx)(n.Wi,{control:r.control,name:"tags",render:e=>{let{field:t}=e;return(0,l.jsxs)(n.xJ,{children:[(0,l.jsx)(n.lX,{children:"Tags (με κόμμα)"}),(0,l.jsx)(n.NI,{children:(0,l.jsx)(i.I,{...t})}),(0,l.jsx)(n.zG,{})]})}}),(0,l.jsx)(n.Wi,{control:r.control,name:"description",render:e=>{let{field:t}=e;return(0,l.jsxs)(n.xJ,{children:[(0,l.jsx)(n.lX,{children:"Περιγραφή"}),(0,l.jsx)(n.NI,{children:(0,l.jsx)(d.g,{...t})}),(0,l.jsx)(n.zG,{})]})}}),(0,l.jsxs)(a.cN,{children:[(0,l.jsx)(a.GG,{asChild:!0,children:(0,l.jsx)(o.z,{type:"button",variant:"outline",disabled:x,children:"Ακύρωση"})}),(0,l.jsxs)(o.z,{type:"submit",disabled:x,children:[x&&(0,l.jsx)(c.Z,{className:"mr-2 h-4 w-4 animate-spin"}),m?"Αποθήκευση":"Προσθήκη"]})]})]})})]})})}},35265:function(e,t,s){"use strict";s.d(t,{Qd:function(){return o},UQ:function(){return d},o4:function(){return c},vF:function(){return u}});var l=s(57437),r=s(2265),a=s(64756),n=s(42421),i=s(49354);let d=a.fC,o=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,l.jsx)(a.ck,{ref:t,className:(0,i.cn)("border-b",s),...r})});o.displayName="AccordionItem";let c=r.forwardRef((e,t)=>{let{className:s,children:r,...d}=e;return(0,l.jsx)(a.h4,{className:"flex",children:(0,l.jsxs)(a.xz,{ref:t,className:(0,i.cn)("flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180",s),...d,children:[r,(0,l.jsx)(n.Z,{className:"h-4 w-4 shrink-0 transition-transform duration-200"})]})})});c.displayName=a.xz.displayName;let u=r.forwardRef((e,t)=>{let{className:s,children:r,...n}=e;return(0,l.jsx)(a.VY,{ref:t,className:"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down",...n,children:(0,l.jsx)("div",{className:(0,i.cn)("pb-4 pt-0",s),children:r})})});u.displayName=a.VY.displayName},29943:function(e,t,s){"use strict";s.d(t,{OL:function(){return f},_T:function(){return x},aR:function(){return d},f$:function(){return j},fY:function(){return m},le:function(){return g},vW:function(){return o},xo:function(){return h},yT:function(){return p}});var l=s(57437),r=s(2265),a=s(76669),n=s(49354),i=s(89733);let d=a.fC,o=a.xz,c=a.h_,u=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,l.jsx)(a.aV,{className:(0,n.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...r,ref:t})});u.displayName=a.aV.displayName;let x=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,l.jsxs)(c,{children:[(0,l.jsx)(u,{}),(0,l.jsx)(a.VY,{ref:t,className:(0,n.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",s),...r})]})});x.displayName=a.VY.displayName;let m=e=>{let{className:t,...s}=e;return(0,l.jsx)("div",{className:(0,n.cn)("flex flex-col space-y-1.5 text-center sm:text-left",t),...s})};m.displayName="AlertDialogHeader";let h=e=>{let{className:t,...s}=e;return(0,l.jsx)("div",{className:(0,n.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...s})};h.displayName="AlertDialogFooter";let j=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,l.jsx)(a.Dx,{ref:t,className:(0,n.cn)("text-lg font-semibold",s),...r})});j.displayName=a.Dx.displayName;let p=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,l.jsx)(a.dk,{ref:t,className:(0,n.cn)("text-sm text-muted-foreground",s),...r})});p.displayName=a.dk.displayName;let f=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,l.jsx)(a.aU,{ref:t,className:(0,n.cn)((0,i.d)(),s),...r})});f.displayName=a.aU.displayName;let g=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,l.jsx)(a.$j,{ref:t,className:(0,n.cn)((0,i.d)({variant:"outline"}),"mt-2 sm:mt-0",s),...r})});g.displayName=a.$j.displayName},80420:function(e,t,s){"use strict";s.d(t,{F$:function(){return d},Q5:function(){return o},qE:function(){return i}});var l=s(57437),r=s(2265),a=s(81464),n=s(49354);let i=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,l.jsx)(a.fC,{ref:t,className:(0,n.cn)("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",s),...r})});i.displayName=a.fC.displayName;let d=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,l.jsx)(a.Ee,{ref:t,className:(0,n.cn)("aspect-square h-full w-full",s),...r})});d.displayName=a.Ee.displayName;let o=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,l.jsx)(a.NY,{ref:t,className:(0,n.cn)("flex h-full w-full items-center justify-center rounded-full bg-muted",s),...r})});o.displayName=a.NY.displayName},79055:function(e,t,s){"use strict";s.d(t,{C:function(){return i}});var l=s(57437);s(2265);var r=s(13027),a=s(49354);let n=(0,r.j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function i(e){let{className:t,variant:s,...r}=e;return(0,l.jsx)("div",{className:(0,a.cn)(n({variant:s}),t),...r})}},44541:function(e,t,s){"use strict";s.d(t,{X:function(){return d}});var l=s(57437),r=s(2265),a=s(69324),n=s(22468),i=s(49354);let d=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,l.jsx)(a.fC,{ref:t,className:(0,i.cn)("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",s),...r,children:(0,l.jsx)(a.z$,{className:(0,i.cn)("flex items-center justify-center text-current"),children:(0,l.jsx)(n.Z,{className:"h-4 w-4"})})})});d.displayName=a.fC.displayName},61617:function(e,t,s){"use strict";s.d(t,{E:function(){return i}});var l=s(57437),r=s(2265),a=s(52431),n=s(49354);let i=r.forwardRef((e,t)=>{let{className:s,value:r,...i}=e;return(0,l.jsx)(a.fC,{ref:t,className:(0,n.cn)("relative h-4 w-full overflow-hidden rounded-full bg-secondary",s),...i,children:(0,l.jsx)(a.z$,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:"translateX(-".concat(100-(r||0),"%)")}})})});i.displayName=a.fC.displayName}},function(e){e.O(0,[3609,9015,8502,1080,5693,5510,323,2962,6460,7853,5590,8275,5975,2885,275,4183,782,3377,2971,7023,1744],function(){return e(e.s=69637)}),_N_E=e.O()}]);