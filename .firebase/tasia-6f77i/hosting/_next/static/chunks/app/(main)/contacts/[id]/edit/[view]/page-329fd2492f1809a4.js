(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3527],{16634:function(e,t,s){Promise.resolve().then(s.bind(s,6383))},6383:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return S}});var i=s(57437),n=s(2265),a=s(16463),c=s(39343),r=s(31014),l=s(69842),u=s(89506),d=s(57697),o=s(86763),f=s(48185),m=s(93363),h=s(3274),y=s(25163),p=s(96902),x=s(18473),b=s(87786),j=s(89733),v=s(95137),D=s(59061);function w(e){let{contactName:t,isSubmitting:s,isDirty:n,onBack:a,form:c}=e;return(0,i.jsx)("div",{className:"sticky top-0 bg-background py-4 z-10 border-b mb-4",children:(0,i.jsxs)("div",{className:"flex items-center justify-between px-1",children:[(0,i.jsx)("div",{className:"flex-1",children:(0,i.jsxs)(j.z,{type:"button",variant:"outline",size:"sm",onClick:a,children:[(0,i.jsx)(v.Z,{className:"mr-2 h-4 w-4"}),"Πίσω στις Επαφές"]})}),(0,i.jsxs)("div",{className:"flex-1 text-center",children:[(0,i.jsx)(f.ll,{children:"Επεξεργασία Επαφής"}),(0,i.jsx)(f.SZ,{children:"Ενημερώστε τα παρακάτω πεδία για να επεξεργαστείτε την επαφή."})]}),(0,i.jsx)("div",{className:"flex-1 flex justify-end",children:(0,i.jsxs)(j.z,{type:"submit",form:"contact-form",disabled:s||!n,children:[s?(0,i.jsx)(h.Z,{className:"mr-2 h-4 w-4 animate-spin"}):(0,i.jsx)(D.Z,{className:"mr-2 h-4 w-4"}),"Αποθήκευση Αλλαγών"]})})]})})}function N(){let e=(0,a.useRouter)(),t=(0,a.useParams)(),s=t.id,j=t.view,{toast:v}=(0,o.pm)(),{user:D}=(0,b.a)(),[N,S]=(0,n.useState)(!0),[k,E]=(0,n.useState)(!1),[g,T]=(0,n.useState)(null),[O,Z]=(0,n.useState)(p.i),[_,C]=(0,n.useState)(""),K=(0,n.useRef)(!1),z=(0,c.cI)({resolver:(0,r.F)(p.O),defaultValues:{}}),U=z.watch("entityType"),J=(0,n.useRef)(),P=e=>{switch(e){case"Φυσικό Πρόσωπο":default:return"individual";case"Νομικό Πρόσωπο":return"legal";case"Δημ. Υπηρεσία":return"public"}},R=e=>{switch(e){case"individual":default:return"Φυσικό Πρόσωπο";case"legal":return"Νομικό Πρόσωπο";case"public":return"Δημ. Υπηρεσία"}};(0,n.useEffect)(()=>{let t=P(U);if(J.current!==U&&(J.current=U,t&&t!==j&&!z.formState.isDirty)){let i="/contacts/".concat(s,"/edit/").concat(t);e.replace(i,{scroll:!1})}},[U,j,e,s]),(0,n.useEffect)(()=>{s&&(async()=>{S(!0);try{let n=(0,l.JU)(u.db,"contacts",s),a=await (0,l.QT)(n);if(a.exists()&&!K.current){var t,i;let e=a.data();C(e.name||"");let s=R(j),n={...e,name:null!==(i=e.name)&&void 0!==i?i:"",entityType:s,id:a.id,birthDate:e.birthDate instanceof l.EK?e.birthDate.toDate():null,identity:{...e.identity,issueDate:(null===(t=e.identity)||void 0===t?void 0:t.issueDate)instanceof l.EK?e.identity.issueDate.toDate():null},addresses:e.addresses||[]};z.reset(n,{keepDirty:!1}),K.current=!0}else a.exists()||(v({variant:"destructive",title:"Σφάλμα",description:"Η επαφή δεν βρέθηκε."}),e.push("/contacts"))}catch(e){console.error("Error fetching contact:",e),v({variant:"destructive",title:"Σφάλμα",description:"Αποτυχία φόρτωσης δεδομένων."})}finally{S(!1)}})()},[s,j]);let A=async e=>{E(!0);let t=e.photoUrls||{},i=P(e.entityType);try{if(g){v({title:"Ενημέρωση επαφής",description:"Ανέβασμα νέας φωτογραφίας..."});let e="contact-images/".concat(i,"/").concat(s,"/").concat(g.name),n=(0,d.iH)(u.tO,e);await (0,d.KV)(n,g);let a=await (0,d.Jt)(n);t[i]=a}let a={...e,photoUrls:t};if(a.birthDate=e.birthDate?l.EK.fromDate(new Date(e.birthDate)):null,a.identity){var n;a.identity.issueDate=(null===(n=e.identity)||void 0===n?void 0:n.issueDate)?l.EK.fromDate(new Date(e.identity.issueDate)):null}e.addresses&&(a.addresses=e.addresses);let c=function e(t){for(let s in t)void 0===t[s]?delete t[s]:"object"!=typeof t[s]||null===t[s]||t[s]instanceof Date||t[s]instanceof l.EK||(e(t[s]),0!==Object.keys(t[s]).length||delete t[s]);return t}(a);delete c.id;let r=(0,l.JU)(u.db,"contacts",s);await (0,l.r7)(r,c),C(e.name||""),z.reset({...e,photoUrls:t},{keepDirty:!1}),T(null),await (0,x.a)("UPDATE_CONTACT",{entityId:s,entityType:"contact",name:e.name,changes:e}),v({title:"Επιτυχία",description:'Οι αλλαγές στην επαφή "'.concat(e.name,'" αποθηκεύτηκαν.')})}catch(e){console.error("Error updating contact: ",e),v({variant:"destructive",title:"Σφάλμα",description:"Δεν ήταν δυνατή η ενημέρωση της επαφής: ".concat(e.message)})}finally{E(!1)}};return N?(0,i.jsx)("div",{className:"flex h-full w-full items-center justify-center",children:(0,i.jsx)(h.Z,{className:"h-16 w-16 animate-spin"})}):(0,i.jsx)(m.l0,{...z,children:(0,i.jsxs)("form",{id:"contact-form",onSubmit:z.handleSubmit(A),className:"space-y-6",children:[(0,i.jsx)(w,{contactName:_,isSubmitting:k,isDirty:z.formState.isDirty,onBack:()=>e.back(),form:z}),(0,i.jsx)(f.Zb,{children:(0,i.jsx)(f.aY,{className:"pt-6",children:(0,i.jsx)(y.t,{form:z,onFileSelect:T,openSections:O,onOpenChange:Z})})})]})})}function S(){return(0,i.jsx)(n.Suspense,{fallback:(0,i.jsx)("div",{className:"flex h-full w-full items-center justify-center",children:(0,i.jsx)(h.Z,{className:"h-16 w-16 animate-spin"})}),children:(0,i.jsx)(N,{})})}}},function(e){e.O(0,[3609,9015,8502,1080,5693,5510,323,2962,6460,7853,5590,8275,2885,275,8198,8254,3343,5377,6503,2971,7023,1744],function(){return e(e.s=16634)}),_N_E=e.O()}]);