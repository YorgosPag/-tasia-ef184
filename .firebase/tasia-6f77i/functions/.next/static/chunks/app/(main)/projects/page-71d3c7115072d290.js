(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2480],{3048:function(e,t,l){Promise.resolve().then(l.bind(l,13652))},13652:function(e,t,l){"use strict";l.r(t),l.d(t,{default:function(){return Q}});var s=l(57437),n=l(2265),r=l(16463),i=l(69842),a=l(89506),c=l(39343),o=l(31014),d=l(86763),u=l(10371),x=l(18473),j=l(89277),h=l(59917),m=l(54662),p=l(93363),f=l(77209),g=l(4919),v=l(2128),w=l(21413),y=l(69081),N=l(89733),C=l(3274),b=l(24241),E=l(49354),I=l(6460),P=l(96153);let k=h.Ry({id:h.Z_().optional(),title:h.Z_().min(1,{message:"Ο τίτλος είναι υποχρεωτικός."}),companyId:h.Z_().min(1,{message:"Η εταιρεία είναι υποχρεωτική."}),location:h.Z_().min(1,{message:"Η τοποθεσία είναι υποχρεωτική."}),description:h.Z_().optional(),deadline:h.hT({required_error:"Η προθεσμία είναι υποχρεωτική."}),status:h.Km(["Ενεργό","Σε εξέλιξη","Ολοκληρωμένο"]),photoUrl:h.Z_().url({message:"Το URL δεν είναι έγκυρο."}).or(h.i0("")).optional(),tags:h.Z_().optional()});function S(e){let{open:t,onOpenChange:l,form:n,onSubmit:r,isSubmitting:i,isLoading:a,editingProject:c,companies:o}=e;return(0,s.jsx)(m.Vq,{open:t,onOpenChange:l,children:(0,s.jsxs)(m.cZ,{className:"sm:max-w-lg",children:[(0,s.jsxs)(m.fK,{children:[(0,s.jsxs)(m.$N,{children:[c?"Επεξεργασία":"Δημιουργία Νέου"," Έργου"]}),(0,s.jsx)(m.Be,{children:c?"Ενημερώστε τις πληροφορίες του έργου.":"Συμπληρώστε τις παρακάτω πληροφορίες για να δημιουργήσετε ένα νέο έργο."})]}),(0,s.jsx)(p.l0,{...n,children:(0,s.jsxs)("form",{onSubmit:r,className:"grid gap-4 py-4 max-h-[80vh] overflow-y-auto pr-6",children:[(0,s.jsx)(p.Wi,{control:n.control,name:"title",render:e=>{let{field:t}=e;return(0,s.jsxs)(p.xJ,{children:[(0,s.jsx)(p.lX,{children:"Τίτλος Έργου"}),(0,s.jsx)(p.NI,{children:(0,s.jsx)(f.I,{placeholder:"π.χ. Ανακαίνιση Κτιρίου",...t})}),(0,s.jsx)(p.zG,{})]})}}),(0,s.jsx)(p.Wi,{control:n.control,name:"companyId",render:e=>{let{field:t}=e;return(0,s.jsxs)(p.xJ,{children:[(0,s.jsx)(p.lX,{children:"Εταιρεία"}),(0,s.jsxs)(v.Ph,{onValueChange:t.onChange,defaultValue:t.value,value:t.value||"",children:[(0,s.jsx)(p.NI,{children:(0,s.jsx)(v.i4,{children:(0,s.jsx)(v.ki,{placeholder:"Επιλέξτε εταιρεία..."})})}),(0,s.jsx)(v.Bw,{children:a?(0,s.jsx)("div",{className:"flex items-center justify-center p-2",children:(0,s.jsx)(C.Z,{className:"h-4 w-4 animate-spin"})}):o.map(e=>(0,s.jsx)(v.Ql,{value:e.id,children:e.name},e.id))})]}),(0,s.jsx)(p.zG,{})]})}}),(0,s.jsx)(p.Wi,{control:n.control,name:"location",render:e=>{let{field:t}=e;return(0,s.jsxs)(p.xJ,{children:[(0,s.jsx)(p.lX,{children:"Τοποθεσία"}),(0,s.jsx)(p.NI,{children:(0,s.jsx)(f.I,{placeholder:"π.χ. Αμπελόκηποι, Αθήνα",...t})}),(0,s.jsx)(p.zG,{})]})}}),(0,s.jsx)(p.Wi,{control:n.control,name:"photoUrl",render:e=>{let{field:t}=e;return(0,s.jsxs)(p.xJ,{children:[(0,s.jsx)(p.lX,{children:"URL Φωτογραφίας (Προαιρετικό)"}),(0,s.jsx)(p.NI,{children:(0,s.jsx)(f.I,{placeholder:"https://example.com/project.jpg",...t})}),(0,s.jsx)(p.zG,{})]})}}),(0,s.jsx)(p.Wi,{control:n.control,name:"tags",render:e=>{let{field:t}=e;return(0,s.jsxs)(p.xJ,{children:[(0,s.jsx)(p.lX,{children:"Tags (χωρισμένα με κόμμα)"}),(0,s.jsx)(p.NI,{children:(0,s.jsx)(f.I,{placeholder:"π.χ. residential, luxury",...t})}),(0,s.jsx)(p.zG,{})]})}}),(0,s.jsx)(p.Wi,{control:n.control,name:"description",render:e=>{let{field:t}=e;return(0,s.jsxs)(p.xJ,{children:[(0,s.jsx)(p.lX,{children:"Περιγραφή (Προαιρετικό)"}),(0,s.jsx)(p.NI,{children:(0,s.jsx)(g.g,{placeholder:"Σύντομη περιγραφή του έργου...",...t})}),(0,s.jsx)(p.zG,{})]})}}),(0,s.jsx)(p.Wi,{control:n.control,name:"deadline",render:e=>{let{field:t}=e;return(0,s.jsxs)(p.xJ,{className:"flex flex-col",children:[(0,s.jsx)(p.lX,{children:"Προθεσμία"}),(0,s.jsxs)(w.J2,{children:[(0,s.jsx)(w.xo,{asChild:!0,children:(0,s.jsx)(p.NI,{children:(0,s.jsxs)(N.z,{variant:"outline",className:(0,E.cn)("w-full pl-3 text-left font-normal",!t.value&&"text-muted-foreground"),children:[t.value?(0,I.WU)(new Date(t.value),"PPP",{locale:P.el}):(0,s.jsx)("span",{children:"Επιλέξτε ημερομηνία"}),(0,s.jsx)(b.Z,{className:"ml-auto h-4 w-4 opacity-50"})]})})}),(0,s.jsx)(w.yk,{className:"w-auto p-0",align:"start",children:(0,s.jsx)(y.f,{mode:"single",selected:t.value?new Date(t.value):void 0,onSelect:t.onChange,disabled:e=>e<new Date(new Date().setHours(0,0,0,0)),initialFocus:!0})})]}),(0,s.jsx)(p.zG,{})]})}}),(0,s.jsx)(p.Wi,{control:n.control,name:"status",render:e=>{let{field:t}=e;return(0,s.jsxs)(p.xJ,{children:[(0,s.jsx)(p.lX,{children:"Κατάσταση (Εμπορική)"}),(0,s.jsxs)(v.Ph,{onValueChange:t.onChange,defaultValue:t.value,children:[(0,s.jsx)(p.NI,{children:(0,s.jsx)(v.i4,{children:(0,s.jsx)(v.ki,{placeholder:"Επιλέξτε κατάσταση"})})}),(0,s.jsxs)(v.Bw,{children:[(0,s.jsx)(v.Ql,{value:"Ενεργό",children:"Ενεργό"}),(0,s.jsx)(v.Ql,{value:"Σε εξέλιξη",children:"Σε εξέλιξη"}),(0,s.jsx)(v.Ql,{value:"Ολοκληρωμένο",children:"Ολοκληρωμένο"})]})]}),(0,s.jsx)(p.zG,{})]})}}),(0,s.jsxs)(m.cN,{children:[(0,s.jsx)(m.GG,{asChild:!0,children:(0,s.jsx)(N.z,{type:"button",variant:"outline",disabled:i,children:"Ακύρωση"})}),(0,s.jsxs)(N.z,{type:"submit",disabled:i||a,children:[i&&(0,s.jsx)(C.Z,{className:"mr-2 h-4 w-4 animate-spin"}),c?"Αποθήκευση":"Δημιουργία"]})]})]})})]})})}var J=l(80405),D=l(87786),O=l(93191);async function _(e){if(!e)throw Error("Project ID is required");let t=await (0,i.QT)((0,i.JU)(a.db,"projects",e));if(!t.exists())throw Error("Project not found");return{id:t.id,...t.data()}}var T=l(48185),L=l(37164),Z=l(96273),U=l(54817),z=l(86864),G=l(57818),R=l(47304),W=l(2183);function A(){return(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)(R.iA,{children:[(0,s.jsx)(R.xD,{children:(0,s.jsxs)(R.SC,{children:[(0,s.jsx)(R.ss,{children:"Τίτλος"}),(0,s.jsx)(R.ss,{children:"Εταιρεία"}),(0,s.jsx)(R.ss,{children:"Τοποθεσία"}),(0,s.jsx)(R.ss,{children:"Πρόοδος Κατασκευής"}),(0,s.jsx)(R.ss,{className:"text-right",children:"Ενέργειες"})]})}),(0,s.jsx)(R.RM,{children:Array.from({length:5}).map((e,t)=>(0,s.jsxs)(R.SC,{className:"group",children:[(0,s.jsx)(R.pj,{children:(0,s.jsx)(W.O,{className:"h-4 w-32"})}),(0,s.jsx)(R.pj,{children:(0,s.jsx)(W.O,{className:"h-4 w-24"})}),(0,s.jsx)(R.pj,{children:(0,s.jsx)(W.O,{className:"h-4 w-28"})}),(0,s.jsx)(R.pj,{children:(0,s.jsxs)("div",{className:"flex flex-col gap-1.5 w-40",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsx)(W.O,{className:"h-5 w-24 rounded-full"}),(0,s.jsx)(W.O,{className:"h-3 w-8"})]}),(0,s.jsx)(W.O,{className:"h-1.5 w-full rounded-full"})]})}),(0,s.jsx)(R.pj,{className:"text-right",children:(0,s.jsx)(W.O,{className:"h-8 w-20 ml-auto"})})]},t))})]})})}let X=(0,G.default)(()=>Promise.all([l.e(7071),l.e(6904)]).then(l.bind(l,76904)).then(e=>e.ProjectTable),{loadableGenerated:{webpack:()=>[76904]},loading:()=>(0,s.jsx)(A,{}),ssr:!1});function K(e){let{filteredProjects:t,searchQuery:l,setSearchQuery:n,isLoading:i,isEditor:a,isDialogOpen:c,isSubmitting:o,editingProject:d,form:x,view:j,router:h,handleExport:m,handleDialogOpenChange:p,onSubmit:g,handleEditClick:v,handleDuplicateProject:w,handleDeleteProject:y,handlePrefetchProject:C}=e,{companies:b,isLoading:E}=(0,u.JE)(),I=(0,r.useSearchParams)().get("view")||"index";return(0,s.jsxs)("div",{className:"flex flex-col gap-8",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("h1",{className:"text-3xl font-bold tracking-tight text-foreground",children:"Έργα"}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsxs)(N.z,{onClick:m,variant:"outline",disabled:i||0===t.length,children:[(0,s.jsx)(L.Z,{className:"mr-2"}),"Εξαγωγή σε JSON"]}),a&&(0,s.jsxs)(N.z,{onClick:()=>p(!0),children:[(0,s.jsx)(Z.Z,{className:"mr-2"}),"Νέο Έργο"]})]})]}),(0,s.jsxs)(z.mQ,{value:I,onValueChange:e=>{h.push("/projects?view=".concat(e))},children:[(0,s.jsxs)(z.dr,{className:"grid w-full grid-cols-2 md:w-1/3",children:[(0,s.jsx)(z.SP,{value:"index",children:"Ευρετήριο"}),(0,s.jsx)(z.SP,{value:"construction",children:"Κατασκευή"})]}),(0,s.jsxs)("div",{className:"relative mt-4",children:[(0,s.jsx)(U.Z,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-muted-foreground"}),(0,s.jsx)(f.I,{type:"search",placeholder:"Αναζήτηση σε τίτλο, τοποθεσία, εταιρεία...",className:"pl-10 w-full md:w-1/3",value:l,onChange:e=>n(e.target.value)})]}),(0,s.jsxs)(T.Zb,{className:"mt-4",children:[(0,s.jsx)(T.Ol,{children:(0,s.jsxs)(T.ll,{children:["Λίστα Έργων (",t.length,")"]})}),(0,s.jsx)(T.aY,{children:i?(0,s.jsx)(A,{}):t.length>0?(0,s.jsx)(X,{projects:t,companies:b,isEditor:a,onEdit:v,onDuplicate:w,onDelete:y,onPrefetch:C}):(0,s.jsx)("p",{className:"text-center text-muted-foreground py-8",children:l?"Δεν βρέθηκαν έργα που να ταιριάζουν με την αναζήτηση.":"Δεν βρέθηκαν έργα."})})]})]}),a&&(0,s.jsx)(S,{open:c,onOpenChange:p,form:x,onSubmit:g,isSubmitting:o,isLoading:E,editingProject:d,companies:b})]})}function Q(){let e=function(){let{projects:e,isLoading:t}=(0,u.Z0)(),{companies:l,isLoading:s}=(0,u.JE)(),{addProject:h}=(0,u.dI)(),{isEditor:m}=(0,D.a)(),p=(0,r.useRouter)(),f=(0,r.useSearchParams)().get("view")||"index",[g,v]=(0,n.useState)(null),[w,y]=(0,n.useState)(!1),[N,C]=(0,n.useState)(!1),{toast:b}=(0,d.pm)(),E=(0,c.cI)({resolver:(0,o.F)(k),defaultValues:{id:void 0,title:"",companyId:"",location:"",description:"",status:"Ενεργό",photoUrl:"",tags:""}}),{filteredProjects:I,searchQuery:P,setSearchQuery:S,getCompanyName:T}=function(e,t){let[l,s]=(0,n.useState)(""),r=(0,n.useCallback)(e=>{var l;return(null===(l=t.find(t=>t.id===e))||void 0===l?void 0:l.name)||e},[t]);return{filteredProjects:(0,n.useMemo)(()=>e?[...e].sort((e,t)=>e.title.localeCompare(t.title)).filter(e=>{let t=l.toLowerCase(),s=r(e.companyId).toLowerCase();return e.title.toLowerCase().includes(t)||e.location&&e.location.toLowerCase().includes(t)||e.description&&e.description.toLowerCase().includes(t)||s.includes(t)||e.tags&&e.tags.some(e=>e.toLowerCase().includes(t))}):[],[e,l,r]),searchQuery:l,setSearchQuery:s,getCompanyName:r}}(e,l),{handleDuplicateProject:L,handleDeleteProject:Z,handleExport:U,handlePrefetchProject:z}=function(e,t,l,s){let{toast:r}=(0,d.pm)(),c=(0,O.NL)(),o=(0,n.useCallback)(e=>{c.prefetchQuery({queryKey:["projectDetails",e],queryFn:()=>_(e),staleTime:3e5})},[c]);return{handleDuplicateProject:(0,n.useCallback)(async l=>{let s=e.find(e=>e.id===l);if(!s){r({variant:"destructive",title:"Σφάλμα",description:"Δεν βρέθηκε το έργο προς αντιγραφή."});return}try{var n;let{id:e,createdAt:a,...c}=s;c.workStageSummary&&delete c.workStageSummary,c.title="".concat(c.title," (Copy)");let o=await t({...c,tags:null===(n=c.tags)||void 0===n?void 0:n.join(","),deadline:c.deadline instanceof i.EK?c.deadline.toDate():c.deadline});r({title:"Επιτυχία",description:"Το έργο '".concat(s.title,"' αντιγράφηκε.")}),o&&await (0,x.a)("DUPLICATE_PROJECT",{entityId:o,entityType:"project",sourceEntityId:l,name:c.title})}catch(e){console.error("Error duplicating project:",e),r({variant:"destructive",title:"Σφάλμα",description:"Η αντιγραφή απέτυχε."})}},[e,r,t]),handleDeleteProject:(0,n.useCallback)(async t=>{try{let l=e.find(e=>e.id===t);await (0,i.oe)((0,i.JU)(a.db,"projects",t)),r({title:"Επιτυχία",description:"Το έργο διαγράφηκε."}),l&&await (0,x.a)("DELETE_PROJECT",{entityId:t,entityType:"project",name:l.title})}catch(e){console.error("Error deleting project:",e),r({variant:"destructive",title:"Σφάλμα",description:"Δεν ήταν δυνατή η διαγραφή του έργου."})}},[e,r]),handleExport:(0,n.useCallback)(()=>{let e=s.map(e=>({...e,companyName:l(e.companyId),deadline:(0,J.p6)(e.deadline),createdAt:(0,J.p6)(e.createdAt)}));(0,j.Rk)(e,"projects")},[s,l]),handlePrefetchProject:o}}(e,h,T,I),G=(0,n.useCallback)(e=>{y(e),e||(E.reset(),v(null))},[E]),R=(0,n.useCallback)(e=>{var t;v(e),E.reset({...e,tags:(null===(t=e.tags)||void 0===t?void 0:t.join(", "))||"",deadline:e.deadline instanceof i.EK?e.deadline.toDate():e.deadline}),y(!0)},[E]),W=(0,n.useCallback)(async e=>{C(!0);try{if(g){var t;let l=(0,i.JU)(a.db,"projects",g.id),{id:s,...n}=e,r={...n,photoUrl:(null===(t=n.photoUrl)||void 0===t?void 0:t.trim())||void 0,tags:n.tags?n.tags.split(",").map(e=>e.trim()).filter(Boolean):[],deadline:i.EK.fromDate(n.deadline)};await (0,i.r7)(l,r),b({title:"Επιτυχία",description:"Το έργο ενημερώθηκε."}),await (0,x.a)("UPDATE_PROJECT",{entityId:g.id,entityType:"project",name:r.title,changes:r})}else{let t=await h(e);b({title:"Επιτυχία",description:"Το έργο προστέθηκε."}),t&&await (0,x.a)("CREATE_PROJECT",{entityId:t,entityType:"project",name:e.title})}G(!1)}catch(e){console.error("Error submitting project: ",e),b({variant:"destructive",title:"Σφάλμα",description:"Δεν ήταν δυνατή η υποβολή: ".concat(e.message)})}finally{C(!1)}},[g,b,h,G]);return{filteredProjects:I,searchQuery:P,setSearchQuery:S,isLoading:t||s,isEditor:m,isDialogOpen:w,isSubmitting:N,editingProject:g,form:E,view:f,router:p,handleExport:U,handleDialogOpenChange:G,onSubmit:E.handleSubmit(W),handleEditClick:R,handleDuplicateProject:L,handleDeleteProject:Z,handlePrefetchProject:z}}();return(0,s.jsx)(K,{...e})}},2183:function(e,t,l){"use strict";l.d(t,{O:function(){return r}});var s=l(57437),n=l(49354);function r(e){let{className:t,...l}=e;return(0,s.jsx)("div",{className:(0,n.cn)("animate-pulse rounded-md bg-muted",t),...l})}},80405:function(e,t,l){"use strict";l.d(t,{Yd:function(){return a},p6:function(){return i}});var s=l(6460),n=l(96153),r=l(69842);l(2265);let i=e=>{if(!e)return"N/A";let t=e instanceof r.EK?e.toDate():e;return(0,s.WU)(t,"dd/MM/yyyy",{locale:n.el})},a=(e,t)=>{var l;return e?(null===(l=t.find(t=>t.id===e))||void 0===l?void 0:l.name)||e:"Άγνωστη εταιρεία"}}},function(e){e.O(0,[3609,9015,8502,1080,5693,5510,323,2962,6460,7853,5590,8275,5975,2885,5303,3377,2971,7023,1744],function(){return e(e.s=3048)}),_N_E=e.O()}]);